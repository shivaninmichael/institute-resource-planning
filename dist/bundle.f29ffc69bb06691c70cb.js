"use strict";(self.webpackChunks_erp_frontend=self.webpackChunks_erp_frontend||[]).push([[792],{6523:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(1601),n=s.n(r),a=s(6314),i=s.n(a)()(n());i.push([e.id,"/* Reset and base styles */\n* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nhtml {\n  height: 100%;\n}\n\nbody {\n  height: 100%;\n  font-family: 'Roboto', 'Helvetica', 'Arial', sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  background-color: #fafafa;\n}\n\n#root {\n  height: 100%;\n  min-height: 100vh;\n}\n\n/* Scrollbar styles */\n::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: #f1f1f1;\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb {\n  background: #c1c1c1;\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: #a8a8a8;\n}\n\n/* Loading and error states */\n.loading {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100vh;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  font-size: 24px;\n}\n\n.error {\n  color: #d32f2f;\n  text-align: center;\n  padding: 20px;\n}\n\n/* Mobile responsive utilities */\n@media (max-width: 600px) {\n  .desktop-only {\n    display: none !important;\n  }\n}\n\n@media (min-width: 601px) {\n  .mobile-only {\n    display: none !important;\n  }\n}\n\n/* Print styles */\n@media print {\n  .no-print {\n    display: none !important;\n  }\n}\n\n/* High contrast mode support */\n@media (prefers-contrast: high) {\n  * {\n    border-color: currentColor !important;\n  }\n}\n\n/* Reduced motion support */\n@media (prefers-reduced-motion: reduce) {\n  * {\n    animation-duration: 0.01ms !important;\n    animation-iteration-count: 1 !important;\n    transition-duration: 0.01ms !important;\n  }\n}\n\n/* Focus styles for accessibility */\n.sr-only {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: -1px;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  white-space: nowrap;\n  border: 0;\n}\n\n/* Material-UI overrides */\n.MuiCssBaseline-root {\n  height: 100%;\n}\n\n.MuiBox-root {\n  box-sizing: border-box;\n}\n\n/* Custom utilities */\n.full-height {\n  height: 100%;\n}\n\n.full-width {\n  width: 100%;\n}\n\n.text-center {\n  text-align: center;\n}\n\n.text-left {\n  text-align: left;\n}\n\n.text-right {\n  text-align: right;\n}\n\n.flex-center {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.flex-between {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.flex-end {\n  display: flex;\n  justify-content: flex-end;\n  align-items: center;\n}\n",""]);const l=i},6659:(e,t,s)=>{var r=s(4848),n=s(6540),a=s(5338),i=s(4976),l=s(9302),o=s(4519),d=s(6544);const c={main:"#1976d2",light:"#42a5f5",dark:"#1565c0",contrastText:"#ffffff"},x={main:"#dc004e",light:"#ff5983",dark:"#9a0036",contrastText:"#ffffff"},u={main:"#2e7d32",light:"#4caf50",dark:"#1b5e20",contrastText:"#ffffff"},h={main:"#ed6c02",light:"#ff9800",dark:"#e65100",contrastText:"#ffffff"},m={main:"#d32f2f",light:"#ef5350",dark:"#c62828",contrastText:"#ffffff"},p={main:"#0288d1",light:"#03a9f4",dark:"#01579b",contrastText:"#ffffff"},A={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121"},j={fontFamily:["Roboto","Helvetica","Arial","sans-serif"].join(","),h1:{fontSize:"2.5rem",fontWeight:300,lineHeight:1.2,letterSpacing:"-0.00833em"},h2:{fontSize:"2rem",fontWeight:300,lineHeight:1.3,letterSpacing:"-0.00833em"},h3:{fontSize:"1.75rem",fontWeight:400,lineHeight:1.4,letterSpacing:"0em"},h4:{fontSize:"1.5rem",fontWeight:400,lineHeight:1.4,letterSpacing:"0.00735em"},h5:{fontSize:"1.25rem",fontWeight:400,lineHeight:1.5,letterSpacing:"0em"},h6:{fontSize:"1.125rem",fontWeight:500,lineHeight:1.6,letterSpacing:"0.0075em"},subtitle1:{fontSize:"1rem",fontWeight:400,lineHeight:1.75,letterSpacing:"0.00938em"},subtitle2:{fontSize:"0.875rem",fontWeight:500,lineHeight:1.57,letterSpacing:"0.00714em"},body1:{fontSize:"1rem",fontWeight:400,lineHeight:1.5,letterSpacing:"0.00938em"},body2:{fontSize:"0.875rem",fontWeight:400,lineHeight:1.43,letterSpacing:"0.01071em"},button:{fontSize:"0.875rem",fontWeight:500,lineHeight:1.75,letterSpacing:"0.02857em",textTransform:"none"},caption:{fontSize:"0.75rem",fontWeight:400,lineHeight:1.66,letterSpacing:"0.03333em"},overline:{fontSize:"0.75rem",fontWeight:400,lineHeight:2.66,letterSpacing:"0.08333em",textTransform:"uppercase"}},g={MuiButton:{styleOverrides:{root:{borderRadius:8,textTransform:"none",fontWeight:500,boxShadow:"none","&:hover":{boxShadow:"0 2px 8px rgba(0,0,0,0.15)"}},contained:{"&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.2)"}},outlined:{borderWidth:2,"&:hover":{borderWidth:2}}},defaultProps:{disableElevation:!0}},MuiCard:{styleOverrides:{root:{borderRadius:12,boxShadow:"0 2px 8px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 4px 16px rgba(0,0,0,0.15)"}}}},MuiPaper:{styleOverrides:{root:{borderRadius:8},elevation1:{boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},elevation2:{boxShadow:"0 4px 16px rgba(0,0,0,0.15)"},elevation3:{boxShadow:"0 8px 24px rgba(0,0,0,0.2)"}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:8}}}},MuiChip:{styleOverrides:{root:{borderRadius:16,fontWeight:500}}},MuiAvatar:{styleOverrides:{root:{borderRadius:8}}},MuiTableHead:{styleOverrides:{root:{"& .MuiTableCell-root":{fontWeight:600,backgroundColor:A[50]}}}},MuiTableCell:{styleOverrides:{root:{borderBottom:`1px solid ${A[200]}`,padding:"16px"}}},MuiTableRow:{styleOverrides:{root:{"&:hover":{backgroundColor:A[50]}}}},MuiDialog:{styleOverrides:{paper:{borderRadius:12}}},MuiDialogTitle:{styleOverrides:{root:{padding:"24px 24px 16px 24px",borderBottom:`1px solid ${A[200]}`}}},MuiDialogContent:{styleOverrides:{root:{padding:"24px"}}},MuiDialogActions:{styleOverrides:{root:{padding:"16px 24px 24px 24px",borderTop:`1px solid ${A[200]}`}}},MuiAppBar:{styleOverrides:{root:{boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}},MuiDrawer:{styleOverrides:{paper:{borderRight:"none",boxShadow:"2px 0 8px rgba(0,0,0,0.1)"}}},MuiListItem:{styleOverrides:{root:{borderRadius:8,margin:"4px 8px","&:hover":{backgroundColor:A[100]}}}},MuiListItemButton:{styleOverrides:{root:{borderRadius:8,margin:"4px 8px","&:hover":{backgroundColor:A[100]},"&.Mui-selected":{backgroundColor:c.light+"20","&:hover":{backgroundColor:c.light+"30"}}}}},MuiTabs:{styleOverrides:{root:{"& .MuiTabs-indicator":{height:3,borderRadius:"3px 3px 0 0"}}}},MuiTab:{styleOverrides:{root:{textTransform:"none",fontWeight:500,minHeight:48}}},MuiLinearProgress:{styleOverrides:{root:{borderRadius:4,height:6}}},MuiCircularProgress:{styleOverrides:{root:{"& .MuiCircularProgress-circle":{strokeLinecap:"round"}}}},MuiSwitch:{styleOverrides:{root:{width:44,height:24,padding:0},switchBase:{padding:2,"&.Mui-checked":{transform:"translateX(20px)"}},thumb:{width:20,height:20},track:{borderRadius:12,opacity:1,backgroundColor:A[300]}}},MuiCheckbox:{styleOverrides:{root:{"&.Mui-checked":{color:c.main}}}},MuiRadio:{styleOverrides:{root:{"&.Mui-checked":{color:c.main}}}},MuiFormControlLabel:{styleOverrides:{root:{marginLeft:0,marginRight:16}}},MuiTooltip:{styleOverrides:{tooltip:{backgroundColor:A[800],borderRadius:6,fontSize:"0.75rem",padding:"8px 12px"},arrow:{color:A[800]}}},MuiSnackbar:{styleOverrides:{root:{"& .MuiSnackbarContent-root":{borderRadius:8}}}},MuiAlert:{styleOverrides:{root:{borderRadius:8,fontWeight:500}}},MuiBreadcrumbs:{styleOverrides:{root:{"& .MuiBreadcrumbs-separator":{margin:"0 8px"}}}},MuiPagination:{styleOverrides:{root:{"& .MuiPaginationItem-root":{borderRadius:8,margin:"0 2px"}}}},MuiRating:{styleOverrides:{root:{"& .MuiRating-iconFilled":{color:h.main},"& .MuiRating-iconHover":{color:h.light}}}},MuiSkeleton:{styleOverrides:{root:{borderRadius:8}}},MuiSpeedDial:{styleOverrides:{fab:{backgroundColor:c.main,"&:hover":{backgroundColor:c.dark}}}},MuiSpeedDialAction:{styleOverrides:{fab:{backgroundColor:A[100],color:A[700],"&:hover":{backgroundColor:A[200]}}}}},y=(e="light")=>{const t="light"===e,s={palette:{mode:e,primary:c,secondary:x,success:u,warning:h,error:m,info:p,grey:A,background:{default:t?A[50]:A[900],paper:t?"#ffffff":A[800]},text:{primary:t?A[900]:A[100],secondary:t?A[700]:A[300]},divider:t?A[200]:A[700]},typography:j,components:g,shape:{borderRadius:8},spacing:8,breakpoints:{values:{xs:0,sm:600,md:960,lg:1280,xl:1920}},shadows:["none","0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)","0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)","0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23)","0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22)","0 19px 38px rgba(0,0,0,0.30), 0 15px 12px rgba(0,0,0,0.22)","0 24px 48px rgba(0,0,0,0.35), 0 20px 16px rgba(0,0,0,0.20)","0 29px 58px rgba(0,0,0,0.40), 0 25px 20px rgba(0,0,0,0.18)","0 34px 68px rgba(0,0,0,0.45), 0 30px 24px rgba(0,0,0,0.16)","0 39px 78px rgba(0,0,0,0.50), 0 35px 28px rgba(0,0,0,0.14)","0 44px 88px rgba(0,0,0,0.55), 0 40px 32px rgba(0,0,0,0.12)","0 49px 98px rgba(0,0,0,0.60), 0 45px 36px rgba(0,0,0,0.10)","0 54px 108px rgba(0,0,0,0.65), 0 50px 40px rgba(0,0,0,0.08)","0 59px 118px rgba(0,0,0,0.70), 0 55px 44px rgba(0,0,0,0.06)","0 64px 128px rgba(0,0,0,0.75), 0 60px 48px rgba(0,0,0,0.04)","0 69px 138px rgba(0,0,0,0.80), 0 65px 52px rgba(0,0,0,0.02)","0 74px 148px rgba(0,0,0,0.85), 0 70px 56px rgba(0,0,0,0.00)","0 79px 158px rgba(0,0,0,0.90), 0 75px 60px rgba(0,0,0,0.00)","0 84px 168px rgba(0,0,0,0.95), 0 80px 64px rgba(0,0,0,0.00)","0 89px 178px rgba(0,0,0,1.00), 0 85px 68px rgba(0,0,0,0.00)","0 94px 188px rgba(0,0,0,1.00), 0 90px 72px rgba(0,0,0,0.00)","0 99px 198px rgba(0,0,0,1.00), 0 95px 76px rgba(0,0,0,0.00)","0 104px 208px rgba(0,0,0,1.00), 0 100px 80px rgba(0,0,0,0.00)","0 109px 218px rgba(0,0,0,1.00), 0 105px 84px rgba(0,0,0,0.00)","0 114px 228px rgba(0,0,0,1.00), 0 110px 88px rgba(0,0,0,0.00)","0 119px 238px rgba(0,0,0,1.00), 0 115px 92px rgba(0,0,0,0.00)","0 124px 248px rgba(0,0,0,1.00), 0 120px 96px rgba(0,0,0,0.00)"]};return(0,d.A)(s)},f=y("light"),b=(y("dark"),{url:"https://wpfcaxallrqnbotmnqal.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwZmNheGFsbHJxbmJvdG1ucWFsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczMzQ3MjQsImV4cCI6MjA3MjkxMDcyNH0.4blTg8upVnSbtzF8825pxYq_XnWtj8TFe2yvlp2PiZk",serviceRoleKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwZmNheGFsbHJxbmJvdG1ucWFsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NzMzNDcyNCwiZXhwIjoyMDcyOTEwNzI0fQ.j02GGKmB7mzlJAIqrRtfiDmaFL2Qivq6Ymc223UqLL0",useSupabaseAuth:!0,appName:"S-ERP",environment:"development",enableDebug:!0});var v=s(7767),_=s(799),S=s(1490);const C="https://wpfcaxallrqnbotmnqal.supabase.co",w="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwZmNheGFsbHJxbmJvdG1ucWFsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NzMzNDcyNCwiZXhwIjoyMDcyOTEwNzI0fQ.j02GGKmB7mzlJAIqrRtfiDmaFL2Qivq6Ymc223UqLL0";console.log("ğŸ” Debug - Environment variables:"),console.log("REACT_APP_SUPABASE_URL:","https://wpfcaxallrqnbotmnqal.supabase.co"),console.log("REACT_APP_SUPABASE_ANON_KEY:","Present"),console.log("âœ… Supabase configuration loaded successfully");const I=(0,S.UU)(C,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwZmNheGFsbHJxbmJvdG1ucWFsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczMzQ3MjQsImV4cCI6MjA3MjkxMDcyNH0.4blTg8upVnSbtzF8825pxYq_XnWtj8TFe2yvlp2PiZk",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},db:{schema:"public"}}),k=async()=>{const{data:{session:e},error:t}=await I.auth.getSession();return{session:e,error:t}},E=async(e,t="*",s)=>{let r=I.from(e).select(t);s&&Object.entries(s).forEach(([e,t])=>{null!=t&&(r=r.eq(e,t))});const{data:n,error:a}=await r;return{data:n,error:a}},T=(w&&(0,S.UU)(C,w,{auth:{autoRefreshToken:!1,persistSession:!1},db:{schema:"public"}}),{user:null,token:null,refreshToken:null,isAuthenticated:!1,isLoading:!0,error:null,currentSession:null,activeSessions:[],requiresMFA:!1,mfaVerified:!1}),P=(e,t)=>{switch(t.type){case"AUTH_START":return{...e,isLoading:!0,error:null};case"AUTH_SUCCESS":return{...e,user:t.payload.user,token:t.payload.token,refreshToken:t.payload.refreshToken,isAuthenticated:!0,isLoading:!1,error:null,requiresMFA:t.payload.requiresMFA||!1,mfaVerified:!t.payload.requiresMFA,currentSession:t.payload.currentSession};case"AUTH_FAILURE":return{...e,user:null,token:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,error:t.payload,currentSession:null,activeSessions:[],requiresMFA:!1,mfaVerified:!1};case"AUTH_LOGOUT":return{...e,user:null,token:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,error:null,currentSession:null,activeSessions:[],requiresMFA:!1,mfaVerified:!1};case"AUTH_REFRESH":return{...e,token:t.payload.token,isLoading:!1};case"PROFILE_UPDATE":return{...e,user:{...e.user,...t.payload}};case"CLEAR_ERROR":return{...e,error:null};default:return e}},D=(0,n.createContext)(void 0),R=({children:e})=>{const[t,s]=(0,n.useReducer)(P,T);let a=null,i=null;const l=()=>{a&&clearTimeout(a),a=setTimeout(()=>{console.log("User inactive for 15 minutes, logging out..."),d()},9e5)},o=()=>{i&&clearInterval(i),i=setInterval(async()=>{try{await c(),console.log("Session refreshed successfully")}catch(e){console.error("Session refresh failed:",e),d()}},18e5)};(0,n.useEffect)(()=>{(async()=>{try{const{session:e,error:t}=await k();if(t)return console.error("Session error:",t),void s({type:"AUTH_LOGOUT"});if(e?.user){const{data:t,error:r}=await E("users","*",{email:e.user.email});if(r||!t||0===t.length)return console.error("Profile error:",r),void s({type:"AUTH_LOGOUT"});const n=t[0];s({type:"AUTH_SUCCESS",payload:{user:{id:n.id,email:n.email,first_name:n.first_name,last_name:n.last_name,phone:n.phone,is_admin:n.is_admin||!1,is_faculty:n.is_faculty||!1,is_student:n.is_student||!1,is_parent:n.is_parent||!1,is_staff:n.is_staff||!1,company_id:n.company_id,department_id:n.department_id,permissions:[],roles:[]},token:e.access_token,refreshToken:e.refresh_token,currentSession:{id:e.user.id,device:navigator.userAgent,ip_address:"Unknown",location:"Unknown",isCurrentSession:!0,lastActivity:(new Date).toISOString(),createdAt:e.user.created_at}}}),l(),o()}else s({type:"AUTH_LOGOUT"})}catch(e){console.error("Auth initialization error:",e),s({type:"AUTH_LOGOUT"})}})();const{data:{subscription:e}}=I.auth.onAuthStateChange(async(e,t)=>{if("SIGNED_IN"===e&&t?.user){const{data:e,error:r}=await E("users","*",{email:t.user.email});if(!r&&e&&e.length>0){const r=e[0];s({type:"AUTH_SUCCESS",payload:{user:{id:r.id,email:r.email,first_name:r.first_name,last_name:r.last_name,phone:r.phone,is_admin:r.is_admin||!1,is_faculty:r.is_faculty||!1,is_student:r.is_student||!1,is_parent:r.is_parent||!1,is_staff:r.is_staff||!1,company_id:r.company_id,department_id:r.department_id,permissions:[],roles:[]},token:t.access_token,refreshToken:t.refresh_token,currentSession:{id:t.user.id,device:navigator.userAgent,ip_address:"Unknown",location:"Unknown",isCurrentSession:!0,lastActivity:(new Date).toISOString(),createdAt:t.user.created_at}}})}l(),o()}else"SIGNED_OUT"===e&&(a&&clearTimeout(a),i&&clearInterval(i),s({type:"AUTH_LOGOUT"}))}),r=()=>{t.isAuthenticated&&l()};return document.addEventListener("mousedown",r),document.addEventListener("keypress",r),document.addEventListener("scroll",r),document.addEventListener("touchstart",r),()=>{e.unsubscribe(),a&&clearTimeout(a),i&&clearInterval(i),document.removeEventListener("mousedown",r),document.removeEventListener("keypress",r),document.removeEventListener("scroll",r),document.removeEventListener("touchstart",r)}},[t.isAuthenticated]);const d=async(e=!1)=>{try{a&&clearTimeout(a),i&&clearInterval(i);const{error:e}=await(async()=>{const{error:e}=await I.auth.signOut();return{error:e}})();e&&console.error("Logout error:",e)}catch(e){console.error("Logout error:",e)}finally{s({type:"AUTH_LOGOUT"}),_.oR.success("Logged out successfully")}},c=async()=>{try{const{data:e,error:t}=await k();if(t||!e.session)throw new Error("No valid session");s({type:"AUTH_REFRESH",payload:{token:e.session.access_token}})}catch(e){throw d(),e}},x={...t,login:async e=>{try{s({type:"AUTH_START"});const{data:t,error:r}=await(async(e,t)=>{const{data:s,error:r}=await I.auth.signInWithPassword({email:e,password:t});return{data:s,error:r}})(e.email,e.password);if(r)throw new Error(r.message);if(!t.user)throw new Error("Login failed");const{data:n,error:a}=await E("users","*",{email:t.user.email});if(a||!n||0===n.length)throw new Error("User profile not found");const i=n[0];s({type:"AUTH_SUCCESS",payload:{user:{id:i.id,email:i.email,first_name:i.first_name,last_name:i.last_name,phone:i.phone,is_admin:i.is_admin||!1,is_faculty:i.is_faculty||!1,is_student:i.is_student||!1,is_parent:i.is_parent||!1,is_staff:i.is_staff||!1,company_id:i.company_id,department_id:i.department_id,permissions:[],roles:[]},token:t.session?.access_token||"",refreshToken:t.session?.refresh_token||"",currentSession:{id:t.user.id,device:navigator.userAgent,ip_address:"Unknown",location:"Unknown",isCurrentSession:!0,lastActivity:(new Date).toISOString(),createdAt:t.user.created_at}}}),_.oR.success("Login successful!")}catch(e){const t=e.message||"Login failed";throw s({type:"AUTH_FAILURE",payload:t}),e}},logout:d,register:async e=>{try{s({type:"AUTH_START"});const{data:t,error:r}=await(async(e,t,s)=>{const{data:r,error:n}=await I.auth.signUp({email:e,password:t,options:{data:s}});return{data:r,error:n}})(e.email,e.password,{first_name:e.first_name,last_name:e.last_name,phone:e.phone});if(r)throw new Error(r.message);if(!t.user)throw new Error("Registration failed");const{error:n}=await(async(e,t)=>{const{data:s,error:r}=await I.from(e).insert(t).select();return{result:s,error:r}})("users",{email:e.email,first_name:e.first_name,last_name:e.last_name,phone:e.phone,is_admin:!1,is_faculty:!1,is_student:!1,is_parent:!1,is_staff:!1,active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()});n&&console.error("Profile creation error:",n),_.oR.success("Registration successful! Please check your email to verify your account.")}catch(e){const t=e.message||"Registration failed";throw s({type:"AUTH_FAILURE",payload:t}),e}},refreshAuth:c,updateProfile:async e=>{try{if(!t.user)throw new Error("No user logged in");const{error:r}=await(async e=>{const{data:t,error:s}=await I.auth.updateUser({data:e});return{data:t,error:s}})(e);if(r)throw new Error(r.message);const{error:n}=await(async(e,t,s)=>{const{data:r,error:n}=await I.from(e).update(s).eq("id",t).select();return{data:r,error:n}})("users",t.user.id,e);if(n)throw new Error(n.message);s({type:"PROFILE_UPDATE",payload:e}),_.oR.success("Profile updated successfully")}catch(e){const t=e.message||"Profile update failed";throw _.oR.error(t),e}},changePassword:async e=>{try{const{error:t}=await(async e=>{const{data:t,error:s}=await I.auth.updateUser({password:e});return{data:t,error:s}})(e.newPassword);if(t)throw new Error(t.message);_.oR.success("Password changed successfully")}catch(e){const t=e.message||"Password change failed";throw _.oR.error(t),e}},clearError:()=>{s({type:"CLEAR_ERROR"})},hasPermission:(e,s,r)=>!!t.user&&(t.user.is_admin,!0),hasRole:e=>{if(!t.user)return!1;switch(e){case"admin":return t.user.is_admin||!1;case"faculty":return t.user.is_faculty||t.user.is_admin||!1;case"student":return t.user.is_student||t.user.is_admin||!1;case"parent":return t.user.is_parent||t.user.is_admin||!1;case"staff":return t.user.is_staff||t.user.is_admin||!1;default:return!1}},verifyMFA:async(e,t)=>{throw new Error("MFA not implemented yet")},setupMFA:async(e,t)=>{throw new Error("MFA not implemented yet")},disableMFA:async e=>{throw new Error("MFA not implemented yet")},getActiveSessions:async()=>[t.currentSession].filter(Boolean),terminateSession:async e=>{t.currentSession?.id===e&&await d()},terminateAllOtherSessions:async()=>{_.oR.success("All other sessions terminated successfully")}};return(0,r.jsx)(D.Provider,{value:x,children:e})},q=()=>{const e=(0,n.useContext)(D);if(void 0===e)throw new Error("useSupabaseAuth must be used within a SupabaseAuthProvider");return e};var M=s(4675),W=s(7708),O=s(4717),F=s(4073),$=s(5001),L=s(7190),U=s(9067),N=s(1385),z=s(2022),B=s(3896),H=s(1543),V=s(9828),G=s(8532),Z=s(1641),J=s(7839),Y=s(1384),X=s(2274),K=s(3341),Q=s(790),ee=s(448),te=s(5423),se=s(5985),re=s(4269),ne=s(2710),ae=s(1299),ie=s(2390),le=s(2291),oe=s(2376),de=s(1184),ce=s(6431),xe=s(9858),ue=s(7944),he=s(1360),me=s(4635),pe=s(7211),Ae=s(7873),je=s(2241),ge=s(2848),ye=s(9799),fe=s(8620),be=s(1432),ve=s(1656),_e=s(2048),Se=s(8451),Ce=s(7562);const we=({open:e,onClose:t,variant:s="persistent",width:a=280})=>{const i=(0,M.A)(),l=(0,W.A)(i.breakpoints.down("md")),o=(0,v.Zp)(),d=(0,v.zy)(),{user:c,hasPermission:x,logout:u}=q(),[h,m]=(0,n.useState)(new Set),[p,A]=(0,n.useState)(!1),j=[{id:"dashboard",label:"Dashboard",icon:se.A,path:"/dashboard",permission:"view_dashboard"},{id:"academics",label:"Academics",icon:re.A,children:[{id:"courses",label:"Courses",icon:he.A,path:"/courses",permission:"manage_courses"},{id:"departments",label:"Departments",icon:re.A,path:"/departments",permission:"manage_departments"},{id:"timetable",label:"Timetable",icon:de.A,path:"/academics/timetable",permission:"view_timetable"}]},{id:"student-management",label:"Student Management",icon:ne.A,children:[{id:"students",label:"Students",icon:be.A,path:"/students",permission:"manage_students"},{id:"enrollments",label:"Enrollments",icon:oe.A,path:"/students/enrollments",permission:"manage_students"},{id:"attendance",label:"Attendance",icon:de.A,path:"/attendance",permission:"mark_attendance"},{id:"admissions",label:"Admissions",icon:be.A,path:"/admissions",permission:"manage_admissions"}]},{id:"faculty-management",label:"Faculty Management",icon:xe.A,children:[{id:"faculty",label:"Faculty",icon:be.A,path:"/faculty",permission:"manage_faculty"}]},{id:"examinations",label:"Examinations",icon:ae.A,children:[{id:"exams",label:"Exams",icon:ae.A,path:"/exams",permission:"manage_exams"},{id:"assignments",label:"Assignments",icon:oe.A,path:"/assignments",permission:"create_assignments"},{id:"results",label:"Results",icon:ae.A,path:"/exams/results",permission:"enter_grades"},{id:"grade-reports",label:"Grade Reports",icon:ae.A,path:"/exams/reports",permission:"view_reports"}]},{id:"library",label:"Library",icon:ie.A,children:[{id:"media",label:"Media",icon:he.A,path:"/library/media",permission:"manage_library"},{id:"issues",label:"Issues",icon:oe.A,path:"/library/issues",permission:"manage_library"},{id:"overdue",label:"Overdue",icon:de.A,path:"/library/overdue",permission:"manage_library"}]},{id:"fees",label:"Fees Management",icon:le.A,children:[{id:"fee-terms",label:"Fee Terms",icon:ee.A,path:"/fees/terms",permission:"manage_fees"},{id:"fee-details",label:"Fee Details",icon:le.A,path:"/fees/details",permission:"manage_fees"},{id:"fee-reports",label:"Fee Reports",icon:ae.A,path:"/fees/reports",permission:"view_reports"}]},{id:"activities",label:"Activities",icon:oe.A,children:[{id:"student-activities",label:"Student Activities",icon:ne.A,path:"/activities/students",permission:"manage_activities"},{id:"events",label:"Events",icon:de.A,path:"/activities/events",permission:"manage_activities"}]},{id:"facilities",label:"Facilities",icon:re.A,children:[{id:"classrooms",label:"Classrooms",icon:re.A,path:"/facilities/classrooms",permission:"manage_facilities"},{id:"venues",label:"Venues",icon:re.A,path:"/facilities/venues",permission:"manage_facilities"}]},{id:"reports",label:"Reports & Analytics",icon:ae.A,children:[{id:"academic-reports",label:"Academic Reports",icon:ae.A,path:"/reports/academic",permission:"view_reports"},{id:"attendance-reports",label:"Attendance Reports",icon:de.A,path:"/reports/attendance",permission:"view_reports"},{id:"financial-reports",label:"Financial Reports",icon:le.A,path:"/reports/financial",permission:"view_reports"}]},{id:"administration",label:"Administration",icon:ce.A,children:[{id:"users",label:"Users",icon:ne.A,path:"/admin/users",permission:"manage_users"},{id:"roles",label:"Roles & Permissions",icon:ee.A,path:"/admin/roles",permission:"manage_users"},{id:"system-settings",label:"System Settings",icon:ee.A,path:"/admin/settings",permission:"manage_system"},{id:"audit-logs",label:"Audit Logs",icon:ae.A,path:"/admin/audit-logs",permission:"manage_system"}]}],g=e=>{if(e.path)o(e.path),l&&t();else if(e.children){const t=new Set(h);t.has(e.id)?t.delete(e.id):t.add(e.id),m(t)}},y=e=>e.path?d.pathname===e.path:!!e.children&&e.children.some(e=>y(e)),f=e=>{if(e.permission){if("string"==typeof e.permission){const t={view_dashboard:{action:"read",resource:"user"},manage_courses:{action:"manage",resource:"course"},manage_departments:{action:"manage",resource:"department"},view_timetable:{action:"read",resource:"course"},manage_students:{action:"manage",resource:"student"},mark_attendance:{action:"create",resource:"attendance"},manage_admissions:{action:"manage",resource:"student"},manage_faculty:{action:"manage",resource:"faculty"},manage_exams:{action:"manage",resource:"exam"},create_assignments:{action:"create",resource:"assignment"},enter_grades:{action:"update",resource:"grade"},view_reports:{action:"read",resource:"report"},manage_library:{action:"manage",resource:"library"},manage_fees:{action:"manage",resource:"fee"},manage_users:{action:"manage",resource:"user"},manage_system:{action:"manage",resource:"setting"}}[e.permission];return!t||x(t.action,t.resource)}return x(e.permission.action,e.permission.resource)}return!e.children||e.children.some(e=>f(e))},b=(e,t=0)=>{if(!f(e))return null;const s=y(e),n=e.children&&e.children.length>0,a=h.has(e.id),l=(e=>!!e.children&&e.children.some(e=>y(e)))(e);return(0,r.jsxs)(U.A,{children:[(0,r.jsx)(me.Ay,{disablePadding:!0,sx:{pl:2*t+2,"& .MuiListItemButton-root":{borderRadius:1,mx:1,mb:.5}},children:(0,r.jsxs)(pe.A,{onClick:()=>g(e),selected:s||l,sx:{minHeight:48,"&.Mui-selected":{backgroundColor:i.palette.primary.light+"20","&:hover":{backgroundColor:i.palette.primary.light+"30"}}},children:[e.icon&&(0,r.jsx)(Ae.A,{sx:{minWidth:p?40:48,color:s?i.palette.primary.main:"inherit"},children:(0,r.jsx)(e.icon,{})}),!p&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(je.A,{primary:e.label,primaryTypographyProps:{fontWeight:s?600:400,color:s?i.palette.primary.main:"inherit"}}),n&&(0,r.jsx)(Z.A,{size:"small",onClick:t=>{t.stopPropagation(),g(e)},children:a?(0,r.jsx)(ve.A,{}):(0,r.jsx)(_e.A,{})})]})]})}),n&&a&&!p&&(0,r.jsx)(ge.A,{in:a,timeout:"auto",unmountOnExit:!0,children:(0,r.jsx)(ye.A,{component:"div",disablePadding:!0,children:e.children.map(e=>b(e,t+1))})})]},e.id)};return(0,r.jsxs)(fe.Ay,{variant:s,open:e,onClose:t,sx:{width:p?80:a,flexShrink:0,"& .MuiDrawer-paper":{width:p?80:a,boxSizing:"border-box",borderRight:`1px solid ${i.palette.divider}`,transition:i.transitions.create("width",{easing:i.transitions.easing.sharp,duration:i.transitions.duration.enteringScreen})}},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",alignItems:"center",justifyContent:p?"center":"space-between",p:2,borderBottom:`1px solid ${i.palette.divider}`,backgroundColor:i.palette.primary.main,color:i.palette.primary.contrastText},children:[!p&&(0,r.jsx)(F.A,{variant:"h6",noWrap:!0,children:"OpenEducat ERP"}),(0,r.jsx)(Z.A,{onClick:()=>{A(!p)},sx:{color:"inherit"},children:p?(0,r.jsx)(Ce.A,{}):(0,r.jsx)(Se.A,{})})]}),(0,r.jsxs)(U.A,{sx:{p:2,borderBottom:`1px solid ${i.palette.divider}`,backgroundColor:i.palette.background.paper},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,r.jsx)(N.A,{sx:{width:48,height:48,mr:2,backgroundColor:i.palette.primary.main},children:c?.first_name?.[0]||c?.email?.[0]||"U"}),!p&&(0,r.jsxs)(U.A,{sx:{flex:1,minWidth:0},children:[(0,r.jsx)(F.A,{variant:"subtitle1",noWrap:!0,children:c?.first_name&&c?.last_name?`${c.first_name} ${c.last_name}`:c?.email||"User"}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",noWrap:!0,children:c?.email}),(0,r.jsx)(z.A,{icon:c?.is_admin?(0,r.jsx)(ce.A,{}):c?.is_faculty?(0,r.jsx)(xe.A,{}):c?.is_student?(0,r.jsx)(re.A,{}):c?.is_parent?(0,r.jsx)(ue.A,{}):(0,r.jsx)(Q.A,{}),label:c?.is_admin?"Administrator":c?.is_faculty?"Faculty":c?.is_student?"Student":c?.is_parent?"Parent":"User",size:"small",variant:"outlined",sx:{mt:.5}})]})]}),!p&&(0,r.jsxs)(U.A,{sx:{display:"flex",gap:1},children:[(0,r.jsx)(Z.A,{size:"small",onClick:()=>o("/profile"),sx:{flex:1},children:(0,r.jsx)(Q.A,{})}),(0,r.jsx)(Z.A,{size:"small",onClick:async()=>{try{await u(),o("/login")}catch(e){console.error("Logout error:",e)}},sx:{flex:1},children:(0,r.jsx)(ee.A,{})})]})]}),(0,r.jsx)(U.A,{sx:{flex:1,overflow:"auto"},children:(0,r.jsx)(ye.A,{component:"nav",sx:{py:1},children:j.map(e=>b(e))})}),!p&&(0,r.jsx)(U.A,{sx:{p:2,borderTop:`1px solid ${i.palette.divider}`,textAlign:"center"},children:(0,r.jsx)(F.A,{variant:"caption",color:"text.secondary",children:"v1.0.0"})})]})},Ie=({children:e})=>{const t=(0,M.A)(),s=(0,W.A)(t.breakpoints.down("md")),a=(0,v.Zp)(),i=(0,v.zy)(),{user:l,logout:o}=q(),[d,c]=(0,n.useState)(!s),[x,u]=(0,n.useState)(null),[h,m]=(0,n.useState)(null);(0,n.useEffect)(()=>{c(!s)},[s]);const p=()=>{u(null)};return(0,r.jsxs)(U.A,{sx:{display:"flex",height:"100vh"},children:[(0,r.jsx)(_.l$,{position:"top-right",toastOptions:{duration:4e3,style:{background:t.palette.background.paper,color:t.palette.text.primary,border:`1px solid ${t.palette.divider}`}}}),(0,r.jsx)(we,{open:d,onClose:()=>c(!1),variant:s?"temporary":"persistent"}),(0,r.jsxs)(U.A,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[(0,r.jsx)(V.A,{position:"sticky",sx:{zIndex:t.zIndex.drawer+1,backgroundColor:t.palette.background.paper,color:t.palette.text.primary,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:(0,r.jsxs)(G.A,{children:[(0,r.jsx)(Z.A,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:()=>{c(!d)},sx:{mr:2},children:(0,r.jsx)(X.A,{})}),(0,r.jsx)(U.A,{sx:{flex:1,display:{xs:"none",sm:"block"}},children:(()=>{const e=(e=>{const t=e.split("/").filter(Boolean),s=[{label:"Home",path:"/",icon:se.A}];let r="";return t.forEach((e,t)=>{r+=`/${e}`;let n=e.charAt(0).toUpperCase()+e.slice(1),a=se.A;switch(e){case"dashboard":n="Dashboard",a=se.A;break;case"students":n="Students",a=ne.A;break;case"faculty":n="Faculty",a=xe.A;break;case"courses":n="Courses",a=re.A;break;case"subjects":n="Subjects",a=he.A;break;case"batches":n="Batches",a=xe.A;break;case"attendance":n="Attendance",a=de.A;break;case"exams":n="Examinations",a=ae.A;break;case"assignments":n="Assignments",a=oe.A;break;case"library":n="Library",a=ie.A;break;case"fees":n="Fees",a=le.A;break;case"reports":n="Reports",a=ae.A;break;case"admin":n="Administration",a=ce.A;break;case"academics":n="Academics",a=re.A;break;case"activities":n="Activities",a=oe.A;break;case"facilities":n="Facilities",a=re.A;break;default:n=e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}s.push({label:n,path:r,icon:a})}),s})(i.pathname);return(0,r.jsx)(O.A,{"aria-label":"breadcrumb",sx:{color:"inherit","& .MuiBreadcrumbs-separator":{color:"inherit"}},children:e.map((t,s)=>s===e.length-1?(0,r.jsxs)(F.A,{color:"inherit",sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(t.icon,{fontSize:"small"}),t.label]},t.path):(0,r.jsxs)($.A,{color:"inherit",href:t.path,onClick:e=>{e.preventDefault(),a(t.path)},sx:{display:"flex",alignItems:"center",gap:1,textDecoration:"none","&:hover":{textDecoration:"underline"}},children:[(0,r.jsx)(t.icon,{fontSize:"small"}),t.label]},t.path))})})()}),(0,r.jsxs)(U.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(J.A,{title:"Notifications",children:(0,r.jsx)(Z.A,{color:"inherit",onClick:e=>{m(e.currentTarget)},children:(0,r.jsx)(Y.A,{badgeContent:0,color:"error",children:(0,r.jsx)(K.A,{})})})}),(0,r.jsx)(J.A,{title:"User menu",children:(0,r.jsx)(Z.A,{color:"inherit",onClick:e=>{u(e.currentTarget)},sx:{ml:1},children:(0,r.jsx)(N.A,{sx:{width:32,height:32,backgroundColor:t.palette.primary.main},children:l?.first_name?.[0]||l?.email?.[0]||"U"})})})]})]})}),(0,r.jsx)(U.A,{component:"main",sx:{flex:1,overflow:"auto",backgroundColor:t.palette.background.default,p:{xs:2,md:3}},children:e})]}),(0,r.jsxs)(L.A,{anchorEl:x,open:Boolean(x),onClose:p,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{mt:1,minWidth:200}},children:[(0,r.jsxs)(U.A,{sx:{p:2,borderBottom:`1px solid ${t.palette.divider}`},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,r.jsx)(N.A,{sx:{width:40,height:40,mr:2,backgroundColor:t.palette.primary.main},children:l?.first_name?.[0]||l?.email?.[0]||"U"}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"subtitle2",noWrap:!0,children:l?.first_name&&l?.last_name?`${l.first_name} ${l.last_name}`:l?.email||"User"}),(0,r.jsx)(F.A,{variant:"caption",color:"text.secondary",noWrap:!0,children:l?.email})]})]}),(0,r.jsx)(z.A,{icon:l?.is_admin?(0,r.jsx)(ce.A,{}):l?.is_faculty?(0,r.jsx)(xe.A,{}):l?.is_student?(0,r.jsx)(re.A,{}):l?.is_parent?(0,r.jsx)(ue.A,{}):(0,r.jsx)(Q.A,{}),label:l?.is_admin?"Administrator":l?.is_faculty?"Faculty":l?.is_student?"Student":l?.is_parent?"Parent":"User",size:"small",variant:"outlined"})]}),(0,r.jsxs)(B.A,{onClick:()=>{a("/profile"),p()},children:[(0,r.jsx)(Q.A,{sx:{mr:2}}),"Profile"]}),(0,r.jsxs)(B.A,{onClick:()=>{a("/settings"),p()},children:[(0,r.jsx)(ee.A,{sx:{mr:2}}),"Settings"]}),(0,r.jsx)(H.A,{}),(0,r.jsxs)(B.A,{onClick:async()=>{try{await o(),a("/login")}catch(e){console.error("Logout error:",e)}p()},children:[(0,r.jsx)(te.A,{sx:{mr:2}}),"Logout"]})]}),(0,r.jsxs)(L.A,{anchorEl:h,open:Boolean(h),onClose:()=>{m(null)},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{mt:1,minWidth:300,maxHeight:400}},children:[(0,r.jsx)(U.A,{sx:{p:2,borderBottom:`1px solid ${t.palette.divider}`},children:(0,r.jsx)(F.A,{variant:"h6",children:"Notifications"})}),(0,r.jsx)(U.A,{sx:{p:2,textAlign:"center"},children:(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"No new notifications"})})]})]})};var ke=s(4977),Ee=s(7636),Te=s(995),Pe=s(9502),De=s(779),Re=s(4433),qe=s(5460),Me=s(5239),We=s(2471),Oe=s(5100),Fe=s(5673),$e=s(6768),Le=s(9898),Ue=s(5042);const Ne=()=>{const e=(0,M.A)(),t=((0,W.A)(e.breakpoints.down("sm")),(0,v.Zp)()),{login:s}=q(),[a,i]=(0,n.useState)({email:"",password:"",role:"student"}),[l,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(!1),[x,u]=(0,n.useState)(null),h=e=>t=>{i(s=>({...s,[e]:t.target.value})),u(null)},m=()=>{switch(a.role){case"admin":return{email:"admin@s-erp.com",password:"admin123"};case"teacher":return{email:"teacher@s-erp.com",password:"teacher123"};default:return{email:"student@s-erp.com",password:"student123"}}};return(0,r.jsx)(U.A,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:e.palette.background.default,p:2},children:(0,r.jsx)(ke.A,{sx:{maxWidth:600,width:"100%",boxShadow:e.shadows[20]},children:(0,r.jsxs)(Ee.A,{sx:{p:4},children:[(0,r.jsxs)(U.A,{display:"flex",flexDirection:"column",alignItems:"center",mb:4,children:[(0,r.jsx)(re.A,{sx:{fontSize:48,color:e.palette.primary.main,mb:2}}),(0,r.jsx)(F.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Welcome to S-ERP"}),(0,r.jsx)(F.A,{variant:"body1",color:"text.secondary",align:"center",children:"Sign in to access your educational dashboard"})]}),(0,r.jsx)("form",{onSubmit:async e=>{e.preventDefault(),c(!0),u(null);try{await s(a),t("/dashboard")}catch(e){u(e instanceof Error?e.message:"Login failed. Please try again.")}finally{c(!1)}},children:(0,r.jsxs)(Te.A,{spacing:3,children:[x&&(0,r.jsx)(Pe.A,{severity:"error",onClose:()=>u(null),children:x}),(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Role"}),(0,r.jsxs)(qe.A,{value:a.role,label:"Role",onChange:e=>h("role")(e),startAdornment:(0,r.jsx)(Me.A,{position:"start",children:(0,r.jsx)(be.A,{})}),children:[(0,r.jsx)(B.A,{value:"student",children:"Student"}),(0,r.jsx)(B.A,{value:"teacher",children:"Teacher"}),(0,r.jsx)(B.A,{value:"admin",children:"Administrator"})]})]}),(0,r.jsx)(We.A,{fullWidth:!0,label:"Email Address",type:"email",value:a.email,onChange:h("email"),InputProps:{startAdornment:(0,r.jsx)(Me.A,{position:"start",children:(0,r.jsx)(be.A,{})})}}),(0,r.jsx)(We.A,{fullWidth:!0,label:"Password",type:l?"text":"password",value:a.password,onChange:h("password"),InputProps:{startAdornment:(0,r.jsx)(Me.A,{position:"start",children:(0,r.jsx)(Le.A,{})}),endAdornment:(0,r.jsx)(Me.A,{position:"end",children:(0,r.jsx)(Z.A,{onClick:()=>o(!l),edge:"end",children:l?(0,r.jsx)($e.A,{}):(0,r.jsx)(Fe.A,{})})})}}),(0,r.jsxs)(U.A,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,children:[(0,r.jsx)($.A,{href:"#",onClick:e=>{e.preventDefault(),t("/auth/forgot-password")},variant:"body2",children:"Forgot password?"}),(0,r.jsx)(Ue.A,{loading:d,variant:"contained",type:"submit",size:"large",children:"Sign In"})]})]})}),(0,r.jsx)(U.A,{my:3,children:(0,r.jsx)(H.A,{children:(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"OR"})})}),(0,r.jsxs)(U.A,{display:"flex",flexDirection:"column",gap:2,children:[(0,r.jsx)(Oe.A,{variant:"outlined",onClick:()=>{const e=m();i(t=>({...t,...e}))},fullWidth:!0,children:"Try Demo Account"}),(0,r.jsxs)(U.A,{display:"flex",justifyContent:"center",gap:1,children:[(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Don't have an account?"}),(0,r.jsx)($.A,{href:"#",onClick:e=>{e.preventDefault(),t("/auth/register")},variant:"body2",children:"Sign up"})]})]}),(0,r.jsxs)(U.A,{mt:4,children:[(0,r.jsxs)(F.A,{variant:"caption",color:"text.secondary",display:"block",align:"center",children:["Demo Credentials for ",a.role,":"]}),(0,r.jsxs)(F.A,{variant:"caption",color:"text.secondary",display:"block",align:"center",children:["Email: ",m().email]}),(0,r.jsxs)(F.A,{variant:"caption",color:"text.secondary",display:"block",align:"center",children:["Password: ",m().password]})]})]})})})};var ze=s(7834),Be=s(538),He=s(9),Ve=s(423),Ge=s(3357),Ze=s(8335),Je=s(9873),Ye=s(1845),Xe=s(3445),Ke=s(1083);const Qe={ALLUSERSPROFILE:"C:\\ProgramData",APPDATA:"C:\\Users\\lenovo\\AppData\\Roaming",ChocolateyInstall:"C:\\ProgramData\\chocolatey",ChocolateyLastPathUpdate:"133979496775963285",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\crashpad_18136_NJCTNHNNAMKCDDIV",COLOR:"1",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"DESKTOP-GM8SG46",ComSpec:"C:\\WINDOWS\\system32\\cmd.exe",CURSOR_TRACE_ID:"c96617223a4546faa924232a9e1db58f",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\WINDOWS\\notepad.exe",EFC_8556_1592913036:"1",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\lenovo\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\lenovo",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\lenovo",INIT_CWD:"D:\\education-institution-resource-planning-DEV\\education-institution-resource-planning-DEV\\SERP",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\lenovo\\AppData\\Local",LOGONSERVER:"\\\\DESKTOP-GM8SG46",NODE:"C:\\Program Files\\nodejs\\node.exe","node.js":"C:\\Program Files\\nodejs",npm_command:"run-script",npm_config_cache:"C:\\Users\\lenovo\\AppData\\Local\\npm-cache",npm_config_globalconfig:"C:\\Users\\lenovo\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\lenovo\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\lenovo\\.npm-init.js",npm_config_local_prefix:"D:\\education-institution-resource-planning-DEV\\education-institution-resource-planning-DEV\\SERP",npm_config_node_gyp:"C:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_npm_version:"10.9.2",npm_config_prefix:"C:\\Users\\lenovo\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\lenovo\\.npmrc",npm_config_user_agent:"npm/10.9.2 node/v22.17.1 win32 x64 workspaces/false",npm_execpath:"C:\\Program Files\\nodejs\\node_modules\\npm\\bin\\npm-cli.js",npm_lifecycle_event:"build",npm_lifecycle_script:"webpack --mode production",npm_node_execpath:"C:\\Program Files\\nodejs\\node.exe",npm_package_json:"D:\\education-institution-resource-planning-DEV\\education-institution-resource-planning-DEV\\SERP\\package.json",npm_package_name:"s-erp-frontend",npm_package_version:"1.0.0",NUMBER_OF_PROCESSORS:"8",OneDrive:"C:\\Users\\lenovo\\OneDrive",OneDriveConsumer:"C:\\Users\\lenovo\\OneDrive",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"D:\\education-institution-resource-planning-DEV\\education-institution-resource-planning-DEV\\SERP\\node_modules\\.bin;D:\\education-institution-resource-planning-DEV\\education-institution-resource-planning-DEV\\node_modules\\.bin;D:\\education-institution-resource-planning-DEV\\node_modules\\.bin;D:\\node_modules\\.bin;C:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Python313\\Scripts\\;C:\\Python313\\;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\Intel\\WiFi\\bin\\;C:\\Program Files\\Common Files\\Intel\\WirelessCommon\\;C:\\ProgramData\\chocolatey\\bin;C:\\Program Files\\nodejs\\;C:\\Program Files\\Git\\cmd;C:\\Users\\lenovo\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\lenovo\\AppData\\Roaming\\npm;C:\\Users\\lenovo\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.PY;.PYW;.CPL",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 142 Stepping 12, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"8e0c",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\lenovo\\OneDrive\\Documents\\WindowsPowerShell\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",REACT_APP_APP_NAME:"S-ERP",REACT_APP_ENABLE_DEBUG:"true",REACT_APP_ENVIRONMENT:"development",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwZmNheGFsbHJxbmJvdG1ucWFsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczMzQ3MjQsImV4cCI6MjA3MjkxMDcyNH0.4blTg8upVnSbtzF8825pxYq_XnWtj8TFe2yvlp2PiZk",REACT_APP_SUPABASE_PASSWORD:"YVMMnoKSOI7BIZIm",REACT_APP_SUPABASE_SERVICE_ROLE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwZmNheGFsbHJxbmJvdG1ucWFsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NzMzNDcyNCwiZXhwIjoyMDcyOTEwNzI0fQ.j02GGKmB7mzlJAIqrRtfiDmaFL2Qivq6Ymc223UqLL0",REACT_APP_SUPABASE_URL:"https://wpfcaxallrqnbotmnqal.supabase.co",REACT_APP_USE_SUPABASE_AUTH:"true",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\WINDOWS",TEMP:"C:\\Users\\lenovo\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.5.11",TMP:"C:\\Users\\lenovo\\AppData\\Local\\Temp",USERDOMAIN:"DESKTOP-GM8SG46",USERDOMAIN_ROAMINGPROFILE:"DESKTOP-GM8SG46",USERNAME:"lenovo",USERPROFILE:"C:\\Users\\lenovo",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\lenovo\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\lenovo\\AppData\\Local\\Programs\\cursor\\Cursor.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-c5a100e279-sock",VSCODE_INJECTION:"1",windir:"C:\\WINDOWS",ZES_ENABLE_SYSMAN:"1"}.REACT_APP_API_URL||"http://localhost:3001/api";class et{constructor(){this.token=null,this.client=Ke.A.create({baseURL:Qe,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.setupInterceptors(),this.loadToken()}setupInterceptors(){this.client.interceptors.request.use(e=>(this.token&&(e.headers.Authorization=`Bearer ${this.token}`),e),e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,e=>(this.handleApiError(e),Promise.reject(e)))}loadToken(){this.token=localStorage.getItem("auth_token")}setToken(e){this.token=e,localStorage.setItem("auth_token",e)}clearToken(){this.token=null,localStorage.removeItem("auth_token")}handleApiError(e){if(e.response){const{status:t,data:s}=e.response;switch(t){case 401:this.clearToken(),window.location.href="/login",_.oR.error("Session expired. Please login again.");break;case 403:_.oR.error("Access denied. Insufficient permissions.");break;case 404:_.oR.error("Resource not found.");break;case 422:s.errors?Object.values(s.errors).forEach(e=>{Array.isArray(e)&&e.forEach(e=>{_.oR.error(e)})}):_.oR.error(s.message||"Validation failed");break;case 429:_.oR.error("Too many requests. Please try again later.");break;case 500:_.oR.error("Server error. Please try again later.");break;default:_.oR.error(s.message||"An error occurred")}}else e.request?_.oR.error("Network error. Please check your connection."):_.oR.error("An unexpected error occurred")}async request(e){try{return(await this.client.request(e)).data}catch(e){throw e}}async get(e,t){return this.request({...t,method:"GET",url:e})}async post(e,t,s){return this.request({...s,method:"POST",url:e,data:t})}async put(e,t,s){return this.request({...s,method:"PUT",url:e,data:t})}async patch(e,t,s){return this.request({...s,method:"PATCH",url:e,data:t})}async delete(e,t){return this.request({...t,method:"DELETE",url:e})}async upload(e,t,s){const r=new FormData;return r.append("file",t),this.request({method:"POST",url:e,data:r,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(s&&e.total){const t=Math.round(100*e.loaded/e.total);s(t)}}})}async download(e,t){try{const s=await this.client.get(e,{responseType:"blob"}),r=new Blob([s.data]),n=window.URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download=t||"download",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(n)}catch(e){throw _.oR.error("Download failed"),e}}}const tt=new et,st={getFaculty:async e=>tt.get("/faculty",{params:e}),getFacultyById:async e=>tt.get(`/faculty/${e}`),createFaculty:async e=>tt.post("/faculty",e),updateFaculty:async(e,t)=>tt.put(`/faculty/${e}`,t),deleteFaculty:async e=>tt.delete(`/faculty/${e}`),searchFaculty:async(e,t)=>tt.get("/faculty/search",{params:{q:e,...t}}),getFacultyByDepartment:async e=>tt.get(`/faculty/department/${e}`),getFacultySubjects:async e=>tt.get(`/faculty/${e}/subjects`),getFacultyDashboard:async e=>tt.get(`/faculty/${e}/dashboard`),getFacultyCourses:async e=>tt.get(`/faculty/${e}/courses`),getCourses:async e=>tt.get("/faculty",{params:e}),getAssignments:async(e,t)=>tt.get(`/faculty/${e}/assignments`,{params:t}),createAssignment:async e=>tt.post("/assignments",e),updateAssignment:async(e,t)=>tt.put(`/assignments/${e}`,t),deleteFacultyAssignment:async e=>tt.delete(`/assignments/${e}`),getAssignmentSubmissions:async e=>tt.get(`/assignments/${e}/submissions`),gradeSubmission:async(e,t)=>tt.put(`/submissions/${e}/grade`,t),getCourseExams:async e=>tt.get(`/courses/${e}/exams`),getExamGrades:async e=>tt.get(`/exams/${e}/grades`),saveGrades:async(e,t)=>tt.put(`/exams/${e}/grades`,{grades:t}),publishGrades:async e=>tt.post(`/exams/${e}/publish-grades`),getAttendanceForDate:async(e,t)=>tt.get(`/attendance/course/${e}/date/${t}`),markAttendance:async e=>tt.post("/attendance/mark",e)},rt={getCourses:async e=>tt.get("/courses",{params:e}),getCourse:async e=>tt.get(`/courses/${e}`),createCourse:async e=>tt.post("/courses",e),updateCourse:async(e,t)=>tt.put(`/courses/${e}`,t),deleteCourse:async e=>tt.delete(`/courses/${e}`),searchCourses:async(e,t)=>tt.get("/courses/search",{params:{q:e,...t}}),getCourseSubjects:async e=>tt.get(`/courses/${e}/subjects`),getCourseBatches:async e=>tt.get(`/courses/${e}/batches`),getCourseStudents:async(e,t)=>tt.get(`/courses/${e}/students`,{params:{batch_id:t}})},nt={getDepartments:async e=>tt.get("/departments",{params:e}),getDepartment:async e=>tt.get(`/departments/${e}`),createDepartment:async e=>tt.post("/departments",e),updateDepartment:async(e,t)=>tt.put(`/departments/${e}`,t),deleteDepartment:async e=>tt.delete(`/departments/${e}`),getDepartmentHierarchy:async()=>tt.get("/departments/hierarchy"),getDepartmentFaculty:async e=>tt.get(`/departments/${e}/faculty`)},at={getAttendanceRegisters:async e=>tt.get("/attendance/registers",{params:e}),getAttendanceSheet:async e=>tt.get(`/attendance/sheets/${e}`),createAttendanceSheet:async e=>tt.post("/attendance/sheets",e),markAttendance:async(e,t)=>tt.post(`/attendance/sheets/${e}/mark`,t),getAttendanceReport:async e=>tt.get("/attendance/report",{params:e}),getStudentAttendance:async(e,t)=>tt.get(`/attendance/students/${e}`,{params:t}),deleteAttendanceSheet:async e=>tt.delete(`/attendance/sheets/${e}`)},it={getExamSessions:async e=>tt.get("/exams/sessions",{params:e}),getExamSession:async e=>tt.get(`/exams/sessions/${e}`),createExamSession:async e=>tt.post("/exams/sessions",e),updateExamSession:async(e,t)=>tt.put(`/exams/sessions/${e}`,t),getExams:async e=>tt.get("/exams",{params:e}),getExam:async e=>tt.get(`/exams/${e}`),createExam:async e=>tt.post("/exams",e),updateExam:async(e,t)=>tt.put(`/exams/${e}`,t),markExamResults:async(e,t)=>tt.post(`/exams/${e}/results`,t),getExamResults:async e=>tt.get(`/exams/${e}/results`),getExamStats:async e=>tt.get("/exams/stats",{params:e}),deleteExamSession:async e=>tt.delete(`/exams/sessions/${e}`),deleteExam:async e=>tt.delete(`/exams/${e}`)},lt={getDashboardStats:()=>tt.get("/transportation/dashboard/stats"),getVehicles:()=>tt.get("/transportation/vehicles"),getVehicle:e=>tt.get(`/transportation/vehicles/${e}`),createVehicle:e=>tt.post("/transportation/vehicles",e),updateVehicle:(e,t)=>tt.put(`/transportation/vehicles/${e}`,t),deleteVehicle:e=>tt.delete(`/transportation/vehicles/${e}`),getDrivers:()=>tt.get("/transportation/drivers"),createDriver:e=>tt.post("/transportation/drivers",e),getRoutes:()=>tt.get("/transportation/routes"),createRoute:e=>tt.post("/transportation/routes",e),createRouteStop:e=>tt.post("/transportation/routes/stops",e),getStudentTransports:()=>tt.get("/transportation/student-transport"),createStudentTransport:e=>tt.post("/transportation/student-transport",e),getMaintenanceRecords:()=>tt.get("/transportation/maintenance"),createMaintenanceRecord:e=>tt.post("/transportation/maintenance",e),updateMaintenanceStatus:(e,t)=>tt.patch(`/transportation/maintenance/${e}/status`,{status:t}),getVehicleRouteAssignments:()=>tt.get("/transportation/vehicle-routes"),createVehicleRouteAssignment:e=>tt.post("/transportation/vehicle-routes",e),certificate:{getDashboardStats:()=>tt.get("/certificate/dashboard/stats"),getAllCertificateTypes:e=>tt.get("/certificate/types",{params:e}),getCertificateTypeById:e=>tt.get(`/certificate/types/${e}`),createCertificateType:e=>tt.post("/certificate/types",e),updateCertificateType:(e,t)=>tt.put(`/certificate/types/${e}`,t),deleteCertificateType:e=>tt.delete(`/certificate/types/${e}`),getAllCertificateTemplates:e=>tt.get("/certificate/templates",{params:e}),getCertificateTemplateById:e=>tt.get(`/certificate/templates/${e}`),createCertificateTemplate:e=>tt.post("/certificate/templates",e),updateCertificateTemplate:(e,t)=>tt.put(`/certificate/templates/${e}`,t),deleteCertificateTemplate:e=>tt.delete(`/certificate/templates/${e}`),getAllCertificates:e=>tt.get("/certificate/certificates",{params:e}),getCertificateById:e=>tt.get(`/certificate/certificates/${e}`),getCertificateByNumber:e=>tt.get(`/certificate/certificates/number/${e}`),createCertificate:e=>tt.post("/certificate/certificates",e),updateCertificate:(e,t)=>tt.put(`/certificate/certificates/${e}`,t),deleteCertificate:e=>tt.delete(`/certificate/certificates/${e}`),verifyCertificate:e=>tt.post("/certificate/verify",e),verifyCertificateByCode:e=>tt.get(`/certificate/verify/${e}`),createCertificateBatch:e=>tt.post("/certificate/batches",e),processCertificateBatch:e=>tt.post(`/certificate/batches/${e}/process`),publicVerifyCertificate:e=>tt.get(`/certificate/verify/${e}`)},alumni:{getDashboardStats:()=>tt.get("/alumni/dashboard/stats"),getAllAlumni:e=>tt.get("/alumni/alumni",{params:e}),getAlumniById:e=>tt.get(`/alumni/alumni/${e}`),createAlumni:e=>tt.post("/alumni/alumni",e),updateAlumni:(e,t)=>tt.put(`/alumni/alumni/${e}`,t),deleteAlumni:e=>tt.delete(`/alumni/alumni/${e}`),getAllAlumniEvents:e=>tt.get("/alumni/events",{params:e}),getAlumniEventById:e=>tt.get(`/alumni/events/${e}`),createAlumniEvent:e=>tt.post("/alumni/events",e),updateAlumniEvent:(e,t)=>tt.put(`/alumni/events/${e}`,t),deleteAlumniEvent:e=>tt.delete(`/alumni/events/${e}`),getAllAlumniDonations:e=>tt.get("/alumni/donations",{params:e}),getAlumniDonationById:e=>tt.get(`/alumni/donations/${e}`),createAlumniDonation:e=>tt.post("/alumni/donations",e),updateAlumniDonation:(e,t)=>tt.put(`/alumni/donations/${e}`,t),deleteAlumniDonation:e=>tt.delete(`/alumni/donations/${e}`),getAllMentorshipPrograms:e=>tt.get("/alumni/mentorship-programs",{params:e}),getMentorshipProgramById:e=>tt.get(`/alumni/mentorship-programs/${e}`),createMentorshipProgram:e=>tt.post("/alumni/mentorship-programs",e),updateMentorshipProgram:(e,t)=>tt.put(`/alumni/mentorship-programs/${e}`,t),deleteMentorshipProgram:e=>tt.delete(`/alumni/mentorship-programs/${e}`),getAllAlumniJobPosts:e=>tt.get("/alumni/job-posts",{params:e}),getAlumniJobPostById:e=>tt.get(`/alumni/job-posts/${e}`),createAlumniJobPost:e=>tt.post("/alumni/job-posts",e),updateAlumniJobPost:(e,t)=>tt.put(`/alumni/job-posts/${e}`,t),deleteAlumniJobPost:e=>tt.delete(`/alumni/job-posts/${e}`),getAlumniByGraduationYear:e=>tt.get(`/alumni/alumni/graduation-year/${e}`),getAlumniByIndustry:e=>tt.get(`/alumni/alumni/industry/${e}`),getWillingMentors:()=>tt.get("/alumni/mentors"),getUpcomingEvents:()=>tt.get("/alumni/events/upcoming")},hostel:{getDashboardStats:()=>tt.get("/hostel/dashboard/stats"),getAllHostels:()=>tt.get("/hostel/hostels"),getHostelById:e=>tt.get(`/hostel/hostels/${e}`),createHostel:e=>tt.post("/hostel/hostels",e),updateHostel:(e,t)=>tt.put(`/hostel/hostels/${e}`,t),deleteHostel:e=>tt.delete(`/hostel/hostels/${e}`),getAllRoomCategories:()=>tt.get("/hostel/room-categories"),createRoomCategory:e=>tt.post("/hostel/room-categories",e),getAllRooms:()=>tt.get("/hostel/rooms"),createRoom:e=>tt.post("/hostel/rooms",e),updateRoom:(e,t)=>tt.put(`/hostel/rooms/${e}`,t),deleteRoom:e=>tt.delete(`/hostel/rooms/${e}`),getAllRoomAllocations:()=>tt.get("/hostel/room-allocations"),createRoomAllocation:e=>tt.post("/hostel/room-allocations",e),updateRoomAllocation:(e,t)=>tt.put(`/hostel/room-allocations/${e}`,t),deleteRoomAllocation:e=>tt.delete(`/hostel/room-allocations/${e}`),getMessMenu:()=>tt.get("/hostel/mess-menu"),createMessMenuItem:e=>tt.post("/hostel/mess-menu",e),getAllVisitorLogs:()=>tt.get("/hostel/visitor-logs"),createVisitorLog:e=>tt.post("/hostel/visitor-logs",e),updateVisitorLog:(e,t)=>tt.put(`/hostel/visitor-logs/${e}`,t),deleteVisitorLog:e=>tt.delete(`/hostel/visitor-logs/${e}`),checkOutVisitor:e=>tt.patch(`/hostel/visitor-logs/${e}/checkout`),getAllMaintenanceRequests:()=>tt.get("/hostel/maintenance-requests"),createMaintenanceRequest:e=>tt.post("/hostel/maintenance-requests",e),updateMaintenanceRequest:(e,t)=>tt.put(`/hostel/maintenance-requests/${e}`,t),deleteMaintenanceRequest:e=>tt.delete(`/hostel/maintenance-requests/${e}`),updateMaintenanceRequestStatus:(e,t)=>tt.patch(`/hostel/maintenance-requests/${e}/status`,{status:t})}},ot=new class extends et{constructor(){super(...arguments),this.students={getStudents:e=>this.get("/students",{params:e}),getAllStudents:()=>this.get("/students"),getStudent:e=>this.get(`/students/${e}`),createStudent:e=>this.post("/students",e),updateStudent:(e,t)=>this.put(`/students/${e}`,t),deleteStudent:e=>this.delete(`/students/${e}`),searchStudents:(e,t)=>this.get("/students/search",{params:{q:e,...t}}),getStudentCourses:e=>this.get(`/students/${e}/courses`),getAttendanceSummary:(e,t)=>this.get(`/students/${e}/attendance`,{params:t}),getExamResults:(e,t)=>this.get(`/students/${e}/exams`,{params:t}),getAcademicPerformance:e=>this.get(`/students/${e}/performance`),getStudentDashboard:e=>this.get(`/students/${e}/dashboard`),bulkCreateStudents:e=>this.post("/students/bulk",{students:e}),transferStudent:(e,t)=>this.post(`/students/${e}/transfer`,t),getStudentsByCourse:(e,t)=>this.get(`/students/course/${e}`,{params:{batch_id:t}}),getStudentsByFaculty:e=>this.get(`/students/faculty/${e}`),generateIdCard:e=>this.get(`/students/${e}/id-card`),getStudentStats:()=>this.get("/students/stats")},this.hostel={getDashboardStats:()=>this.get("/hostel/dashboard/stats"),getAllHostels:()=>this.get("/hostel/hostels"),getHostelById:e=>this.get(`/hostel/hostels/${e}`),createHostel:e=>this.post("/hostel/hostels",e),updateHostel:(e,t)=>this.put(`/hostel/hostels/${e}`,t),deleteHostel:e=>this.delete(`/hostel/hostels/${e}`),getAllRoomCategories:()=>this.get("/hostel/room-categories"),createRoomCategory:e=>this.post("/hostel/room-categories",e),getAllRooms:()=>this.get("/hostel/rooms"),createRoom:e=>this.post("/hostel/rooms",e),updateRoom:(e,t)=>this.put(`/hostel/rooms/${e}`,t),deleteRoom:e=>this.delete(`/hostel/rooms/${e}`),getAllRoomAllocations:()=>this.get("/hostel/room-allocations"),createRoomAllocation:e=>this.post("/hostel/room-allocations",e),updateRoomAllocation:(e,t)=>this.put(`/hostel/room-allocations/${e}`,t),deleteRoomAllocation:e=>this.delete(`/hostel/room-allocations/${e}`),getMessMenu:()=>this.get("/hostel/mess-menu"),createMessMenuItem:e=>this.post("/hostel/mess-menu",e),getAllVisitorLogs:()=>this.get("/hostel/visitor-logs"),createVisitorLog:e=>this.post("/hostel/visitor-logs",e),updateVisitorLog:(e,t)=>this.put(`/hostel/visitor-logs/${e}`,t),deleteVisitorLog:e=>this.delete(`/hostel/visitor-logs/${e}`),checkOutVisitor:e=>this.patch(`/hostel/visitor-logs/${e}/checkout`),getAllMaintenanceRequests:()=>this.get("/hostel/maintenance-requests"),createMaintenanceRequest:e=>this.post("/hostel/maintenance-requests",e),updateMaintenanceRequest:(e,t)=>this.put(`/hostel/maintenance-requests/${e}`,t),deleteMaintenanceRequest:e=>this.delete(`/hostel/maintenance-requests/${e}`),updateMaintenanceRequestStatus:(e,t)=>this.patch(`/hostel/maintenance-requests/${e}/status`,{status:t})}}};ot.certificate={getCertificateTypes:e=>ot.get("/certificate-types",{params:e}),getCertificateType:e=>ot.get(`/certificate-types/${e}`),createCertificateType:e=>ot.post("/certificate-types",e),updateCertificateType:(e,t)=>ot.put(`/certificate-types/${e}`,t),deleteCertificateType:e=>ot.delete(`/certificate-types/${e}`),getCertificates:e=>ot.get("/certificates",{params:e}),getCertificate:e=>ot.get(`/certificates/${e}`),createCertificate:e=>ot.post("/certificates",e),updateCertificate:(e,t)=>ot.put(`/certificates/${e}`,t),deleteCertificate:e=>ot.delete(`/certificates/${e}`),getAllCertificateTypes:e=>ot.get("/certificate-types",{params:e}),getAllCertificateTemplates:e=>ot.get("/certificate-templates",{params:e}),getAllCertificates:e=>ot.get("/certificates",{params:e})},st.getCourses=st.getFaculty,st.getById=st.getFacultyById,st.create=st.createFaculty,st.update=st.updateFaculty,rt.getById=rt.getCourse,rt.create=rt.createCourse,rt.update=rt.updateCourse,nt.getById=nt.getDepartment,nt.create=nt.createDepartment,nt.update=nt.updateDepartment,it.getById=it.getExam,it.create=it.createExam,it.update=it.updateExam,ot.student=ot.students,ot.alumni=lt.alumni,ot.partner={getAllPartners:()=>ot.get("/partners")},ot.department={getAllDepartments:()=>nt.getDepartments()},ot.program={getAllPrograms:()=>ot.get("/programs")},ot.course={getAllCourses:()=>rt.getCourses(),getAllBatches:()=>ot.get("/batches")},at.getById=at.getAttendanceSheet,at.create=at.createAttendanceSheet,at.update=(e,t)=>ot.put(`/attendance/sheets/${e}`,t),ot.students.getCourses=()=>rt.getCourses(),new class{async login(e){return(await tt.post("/auth/login",e)).data}async logout(e=!1){await tt.post("/auth/logout",{fromAllDevices:e})}async register(e){return(await tt.post("/auth/register",e)).data}async refreshToken(e){return(await tt.post("/auth/refresh",{refreshToken:e})).data}async verifyToken(){await tt.post("/auth/verify")}async getProfile(){return(await tt.get("/auth/profile")).data}async updateProfile(e){return(await tt.put("/auth/profile",e)).data}async changePassword(e){await tt.post("/auth/change-password",e)}async requestPasswordReset(e){await tt.post("/auth/forgot-password",{email:e})}async resetPassword(e,t){await tt.post("/auth/reset-password",{token:e,newPassword:t})}async getMFAMethods(){return(await tt.get("/auth/mfa/methods")).data}async setupMFA(e,t){return(await tt.post("/auth/mfa/setup",{method:e,...t})).data}async verifyMFA(e,t){return(await tt.post("/auth/mfa/verify",{code:e,method:t})).data}async disableMFA(e){await tt.delete(`/auth/mfa/${e}`)}async getActiveSessions(){return(await tt.get("/auth/sessions")).data}async terminateSession(e){await tt.delete(`/auth/sessions/${e}`)}async terminateAllOtherSessions(){await tt.delete("/auth/sessions")}async getRoles(){return(await tt.get("/auth/roles")).data}async getPermissions(){return(await tt.get("/auth/permissions")).data}async getPermissionGroups(){return(await tt.get("/auth/permission-groups")).data}async assignRole(e,t){await tt.post(`/auth/users/${e}/roles`,{roleId:t})}async removeRole(e,t){await tt.delete(`/auth/users/${e}/roles/${t}`)}async assignPermission(e,t){await tt.post(`/auth/users/${e}/permissions`,{permissionId:t})}async removePermission(e,t){await tt.delete(`/auth/users/${e}/permissions/${t}`)}async sendEmailVerification(){await tt.post("/auth/verify-email/send")}async verifyEmail(e){await tt.post("/auth/verify-email",{token:e})}async sendPhoneVerification(){await tt.post("/auth/verify-phone/send")}async verifyPhone(e){await tt.post("/auth/verify-phone",{code:e})}async getLoginHistory(e){return(await tt.get(`/auth/users/${e}/login-history`)).data}async getSecurityLog(e){return(await tt.get(`/auth/users/${e}/security-log`)).data}async updateSecurityPreferences(e){await tt.put("/auth/security-preferences",e)}},localStorage.getItem("auth_token"),localStorage.getItem("refresh_token");const dt=(0,n.createContext)(void 0);function ct(e){const{children:t,value:s,index:n,...a}=e;return(0,r.jsx)("div",{role:"tabpanel",hidden:s!==n,id:`mfa-tabpanel-${n}`,"aria-labelledby":`mfa-tab-${n}`,...a,children:s===n&&(0,r.jsx)(U.A,{sx:{p:3},children:t})})}const xt=()=>{const e=(0,v.Zp)(),{verifyMFA:t,setupMFA:s,user:a}=(()=>{const e=(0,n.useContext)(dt);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e})(),[i,l]=(0,n.useState)(0),[o,d]=(0,n.useState)(""),[c,x]=(0,n.useState)(!1),[u,h]=(0,n.useState)(null),[m,p]=(0,n.useState)(null),[A,j]=(0,n.useState)(null);(0,n.useEffect)(()=>{a?.mfa_methods&&0===a.mfa_methods.length&&l(1)},[a]);const g=async e=>{try{x(!0),h(null);const t=await s(e);t?.qrCode&&p(t.qrCode),t?.secret&&j(t.secret)}catch(e){h(e.response?.data?.message||"Setup failed")}finally{x(!1)}};return(0,r.jsx)(ze.A,{maxWidth:"sm",children:(0,r.jsx)(U.A,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",py:4},children:(0,r.jsxs)(Be.A,{elevation:3,sx:{p:4,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,r.jsx)(Ze.A,{color:"primary",sx:{width:48,height:48,mb:2}}),(0,r.jsx)(F.A,{component:"h1",variant:"h5",gutterBottom:!0,children:"Two-Factor Authentication"}),u&&(0,r.jsx)(Pe.A,{severity:"error",sx:{width:"100%",mb:2},children:u}),(0,r.jsxs)(He.A,{value:i,onChange:(e,t)=>l(t),sx:{mb:3,width:"100%"},children:[(0,r.jsx)(Ve.A,{label:"Verify",disabled:!a?.mfa_methods||0===a.mfa_methods.length}),(0,r.jsx)(Ve.A,{label:"Setup"}),(0,r.jsx)(Ve.A,{label:"Help"})]}),(0,r.jsx)(ct,{value:i,index:0,children:(0,r.jsxs)(U.A,{sx:{width:"100%"},children:[(0,r.jsx)(F.A,{variant:"body1",gutterBottom:!0,children:"Enter the verification code from your authenticator app or device."}),(0,r.jsx)(We.A,{fullWidth:!0,label:"Verification Code",value:o,onChange:e=>d(e.target.value),margin:"normal",autoFocus:!0,inputProps:{maxLength:6},sx:{mb:2}}),(0,r.jsx)(Oe.A,{fullWidth:!0,variant:"contained",onClick:async()=>{try{x(!0),h(null);const s=a?.mfa_methods?.find(e=>e.isEnabled)?.type||"authenticator";await t(o,s),e("/dashboard")}catch(e){h(e.response?.data?.message||"Verification failed")}finally{x(!1)}},disabled:c||6!==o.length,children:c?(0,r.jsx)(Ge.A,{size:24}):"Verify"})]})}),(0,r.jsx)(ct,{value:i,index:1,children:(0,r.jsxs)(U.A,{sx:{width:"100%"},children:[(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Choose a verification method:"}),(0,r.jsxs)(U.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[(0,r.jsx)(Oe.A,{variant:"outlined",startIcon:(0,r.jsx)(Xe.A,{}),onClick:()=>g("authenticator"),disabled:c,children:"Authenticator App"}),(0,r.jsx)(Oe.A,{variant:"outlined",startIcon:(0,r.jsx)(Je.A,{}),onClick:()=>g("sms"),disabled:c,children:"SMS Verification"}),(0,r.jsx)(Oe.A,{variant:"outlined",startIcon:(0,r.jsx)(Ye.A,{}),onClick:()=>g("email"),disabled:c,children:"Email Verification"})]}),m&&(0,r.jsxs)(U.A,{sx:{mt:3,textAlign:"center"},children:[(0,r.jsx)(F.A,{variant:"subtitle1",gutterBottom:!0,children:"Scan this QR code with your authenticator app:"}),(0,r.jsx)("img",{src:m,alt:"QR Code",style:{width:200,height:200}}),A&&(0,r.jsxs)(F.A,{variant:"body2",sx:{mt:2},children:["Manual entry code: ",(0,r.jsx)("code",{children:A})]})]})]})}),(0,r.jsx)(ct,{value:i,index:2,children:(0,r.jsxs)(U.A,{sx:{width:"100%"},children:[(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Need Help?"}),(0,r.jsx)(F.A,{variant:"body1",paragraph:!0,children:"Two-factor authentication adds an extra layer of security to your account. After entering your password, you'll need to provide a verification code from your chosen authentication method."}),(0,r.jsx)(F.A,{variant:"subtitle1",gutterBottom:!0,children:"Recommended authenticator apps:"}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:"Google Authenticator"}),(0,r.jsx)("li",{children:"Microsoft Authenticator"}),(0,r.jsx)("li",{children:"Authy"})]}),(0,r.jsxs)(F.A,{variant:"body2",sx:{mt:2},children:["Lost access to your authentication method?"," ",(0,r.jsx)($.A,{href:"/help/mfa",underline:"hover",children:"Contact support"})]})]})}),(0,r.jsx)(U.A,{sx:{mt:3,width:"100%",textAlign:"center"},children:(0,r.jsx)(Oe.A,{variant:"text",onClick:()=>e(-1),sx:{mt:2},children:"Go Back"})})]})})})};var ut=s(8239),ht=s(7657),mt=s(5956),pt=s(7458),At=s(6389),jt=s(6256),gt=s(5897);const yt=({title:e,value:t,description:s,trend:a,trendLabel:i,progress:l,icon:o,color:d="primary"})=>{const c=(0,M.A)(),x=e=>e>0?c.palette.success.main:e<0?c.palette.error.main:c.palette.text.secondary;return(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{children:[(0,r.jsxs)(U.A,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:e}),(0,r.jsx)(F.A,{variant:"h4",component:"div",fontWeight:"bold",children:t})]}),o&&(0,r.jsx)(U.A,{sx:{backgroundColor:c.palette[d].light,borderRadius:"50%",p:1,display:"flex",alignItems:"center",justifyContent:"center"},children:n.cloneElement(o,{sx:{color:c.palette[d].main}})})]}),s&&(0,r.jsxs)(U.A,{display:"flex",alignItems:"center",mb:1,children:[(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:s}),s&&(0,r.jsx)(J.A,{title:s,children:(0,r.jsx)(Z.A,{size:"small",children:(0,r.jsx)(gt.A,{fontSize:"small"})})})]}),"number"==typeof a&&(0,r.jsxs)(U.A,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(e=>e>0?(0,r.jsx)(At.A,{sx:{color:x(e)}}):e<0?(0,r.jsx)(jt.A,{sx:{color:x(e)}}):null)(a),(0,r.jsxs)(F.A,{variant:"body2",sx:{color:x(a)},children:[a>0?"+":"",a,"%"]}),i&&(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:i})]}),"number"==typeof l&&(0,r.jsxs)(U.A,{sx:{width:"100%",mt:2},children:[(0,r.jsx)(pt.A,{variant:"determinate",value:l,color:d,sx:{height:6,borderRadius:3,backgroundColor:c.palette[d].light,"& .MuiLinearProgress-bar":{borderRadius:3}}}),(0,r.jsxs)(F.A,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block",textAlign:"right"},children:[l,"% Complete"]})]})]})})};var ft=s(3650),bt=s(1795),vt=s(399),_t=s(2702);const St=({title:e,subtitle:t,chart:s,height:a=300,onRefresh:i,onDownload:l,actions:o,loading:d})=>{const c=(0,M.A)(),[x,u]=n.useState(null),h=()=>{u(null)};return(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{title:(0,r.jsxs)(U.A,{display:"flex",alignItems:"center",gap:1,children:[(0,r.jsx)(F.A,{variant:"h6",children:e}),d&&(0,r.jsx)(U.A,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:c.palette.primary.main,animation:"pulse 1.5s infinite"}})]}),subheader:t,action:(0,r.jsxs)(U.A,{display:"flex",alignItems:"center",children:[o,(i||l)&&(0,r.jsx)(Z.A,{size:"small",onClick:e=>{u(e.currentTarget)},"aria-label":"chart options",children:(0,r.jsx)(bt.A,{})}),(0,r.jsxs)(L.A,{anchorEl:x,open:Boolean(x),onClose:h,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[i&&(0,r.jsxs)(B.A,{onClick:()=>{h(),i?.()},children:[(0,r.jsx)(_t.A,{fontSize:"small",sx:{mr:1}}),"Refresh"]}),l&&(0,r.jsxs)(B.A,{onClick:()=>{h(),l?.()},children:[(0,r.jsx)(vt.A,{fontSize:"small",sx:{mr:1}}),"Download"]})]})]})}),(0,r.jsx)(H.A,{}),(0,r.jsx)(Ee.A,{children:(0,r.jsx)(U.A,{sx:{height:a,width:"100%",opacity:d?.5:1,transition:"opacity 0.3s ease"},children:s})})]})};var Ct=s(1471),wt=s(4448),It=s(1333),kt=s(1746);const Et=({activities:e,title:t="Recent Activities",showHeader:s=!0,maxItems:a=5,onSeeAll:i})=>{const l=(0,M.A)(),o=e=>{switch(e){case"assignment":return(0,r.jsx)(oe.A,{});case"payment":return(0,r.jsx)(le.A,{});case"exam":return(0,r.jsx)(re.A,{});case"event":default:return(0,r.jsx)(It.A,{});case"attendance":return(0,r.jsx)(de.A,{});case"grade":return(0,r.jsx)(kt.A,{});case"profile":return(0,r.jsx)(be.A,{})}},d=e=>{switch(e){case"assignment":default:return l.palette.primary.main;case"payment":return l.palette.success.main;case"exam":return l.palette.error.main;case"event":return l.palette.info.main;case"attendance":return l.palette.warning.main;case"grade":return l.palette.secondary.main;case"profile":return l.palette.grey[500]}},c=e=>{switch(e?.toLowerCase()){case"completed":return"success";case"pending":return"warning";case"overdue":return"error";default:return"default"}},x=e=>{const t=new Date(e),s=(new Date).getTime()-t.getTime(),r=Math.floor(s/6e4),n=Math.floor(r/60),a=Math.floor(n/24);return r<60?`${r}m ago`:n<24?`${n}h ago`:1===a?"Yesterday":a<7?`${a}d ago`:t.toLocaleDateString()},u=a?e.slice(0,a):e;return(0,r.jsxs)(ke.A,{children:[s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ft.A,{title:t,action:(0,r.jsx)(Z.A,{size:"small",children:(0,r.jsx)(bt.A,{})})}),(0,r.jsx)(H.A,{})]}),(0,r.jsxs)(Ee.A,{sx:{p:0},children:[(0,r.jsx)(ye.A,{disablePadding:!0,children:u.map((e,t)=>(0,r.jsxs)(n.Fragment,{children:[(0,r.jsxs)(me.Ay,{alignItems:"flex-start",sx:{px:2,py:1.5},children:[(0,r.jsx)(Ct.A,{children:e.user?.avatar?(0,r.jsx)(N.A,{src:e.user.avatar}):(0,r.jsx)(N.A,{sx:{bgcolor:d(e.type)},children:o(e.type)})}),(0,r.jsx)(je.A,{primary:(0,r.jsxs)(U.A,{display:"flex",alignItems:"center",gap:1,children:[(0,r.jsx)(F.A,{variant:"subtitle2",children:e.title}),e.status&&(0,r.jsx)(z.A,{label:e.status,size:"small",color:c(e.status)})]}),secondary:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.A,{component:"span",variant:"body2",color:"text.primary",children:e.user?.name&&`${e.user.name} - `}),(0,r.jsx)(F.A,{component:"span",variant:"body2",color:"text.secondary",children:e.description})]})}),(0,r.jsx)(wt.A,{children:(0,r.jsx)(F.A,{variant:"caption",color:"text.secondary",children:x(e.timestamp)})})]}),t<u.length-1&&(0,r.jsx)(H.A,{component:"li"})]},e.id))}),i&&e.length>a&&(0,r.jsx)(U.A,{sx:{p:2,textAlign:"center"},children:(0,r.jsx)(Oe.A,{onClick:i,size:"small",children:"See All Activities"})})]})]})},Tt=1250,Pt=5.2,Dt="vs last month",Rt="85%",qt=-2.1,Mt="vs last week",Wt=85,Ot=45,Ft=38,$t=84,Lt="$125,000",Ut=12.5,Nt="vs last month",zt=75,Bt=[{id:"1",type:"assignment",title:"New Assignment Posted",description:"Mathematics Assignment 3 has been posted",timestamp:"2024-01-15T10:30:00Z",user:{name:"Prof. Smith"},status:"pending"},{id:"2",type:"payment",title:"Fee Payment Received",description:"Semester fee payment processed successfully",timestamp:"2024-01-15T09:15:00Z",status:"completed"},{id:"3",type:"exam",title:"Exam Results Published",description:"Mid-term examination results are now available",timestamp:"2024-01-14T15:45:00Z",status:"completed"},{id:"4",type:"attendance",title:"Attendance Updated",description:"Your attendance for today has been marked",timestamp:"2024-01-14T08:30:00Z",status:"completed"},{id:"5",type:"event",title:"New Event Scheduled",description:"Annual Sports Day scheduled for next month",timestamp:"2024-01-13T11:20:00Z",status:"upcoming"}],Ht=()=>{(0,M.A)();const{user:e}=q(),[t,s]=(0,n.useState)("This Month"),[a,i]=(0,n.useState)(null),l=e=>{e&&s(e),i(null)};return(0,r.jsxs)(U.A,{sx:{p:3},children:[(0,r.jsxs)(U.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Dashboard"}),(0,r.jsxs)(F.A,{variant:"subtitle1",color:"text.secondary",children:["Welcome back, ",e?.first_name||"User"]})]}),(0,r.jsxs)(U.A,{display:"flex",alignItems:"center",gap:1,children:[(0,r.jsx)(Oe.A,{variant:"outlined",startIcon:(0,r.jsx)(mt.A,{}),onClick:e=>{i(e.currentTarget)},children:t}),(0,r.jsxs)(L.A,{anchorEl:a,open:Boolean(a),onClose:()=>l(),children:[(0,r.jsx)(B.A,{onClick:()=>l("Today"),children:"Today"}),(0,r.jsx)(B.A,{onClick:()=>l("This Week"),children:"This Week"}),(0,r.jsx)(B.A,{onClick:()=>l("This Month"),children:"This Month"}),(0,r.jsx)(B.A,{onClick:()=>l("This Year"),children:"This Year"})]})]})]}),(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,mb:3,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(yt,{title:"Total Students",value:Tt,trend:Pt,trendLabel:Dt,icon:(0,r.jsx)(ne.A,{}),color:"primary"})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(yt,{title:"Attendance Rate",value:Rt,trend:qt,trendLabel:Mt,progress:Wt,icon:(0,r.jsx)(ht.A,{}),color:"warning"})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(yt,{title:"Assignments",value:`${Ft}/${Ot}`,description:"Completed assignments",progress:$t,icon:(0,r.jsx)(oe.A,{}),color:"success"})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(yt,{title:"Fees Collected",value:Lt,trend:Ut,trendLabel:Nt,progress:zt,icon:(0,r.jsx)(le.A,{}),color:"info"})})]}),(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:8,children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(St,{title:"Academic Performance",subtitle:"Student performance across subjects",chart:(0,r.jsx)("div",{style:{height:300},children:"Chart placeholder"}),onRefresh:()=>console.log("Refreshing chart..."),onDownload:()=>console.log("Downloading chart...")})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(St,{title:"Attendance Trends",subtitle:"Daily attendance statistics",chart:(0,r.jsx)("div",{style:{height:300},children:"Chart placeholder"}),onRefresh:()=>console.log("Refreshing chart..."),onDownload:()=>console.log("Downloading chart...")})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(Et,{activities:Bt,title:"Recent Activities",onSeeAll:()=>console.log("Viewing all activities...")})})]})]})};var Vt=s(6798),Gt=s(4774),Zt=s(2325),Jt=s(3198),Yt=s(4137),Xt=s(6627),Kt=s(3884),Qt=s(9279),es=s(7037),ts=s(6831),ss=s(2477),rs=s(8763),ns=s(6718),as=s(4745),is=s(8597),ls=s(7034),os=s(2183);const ds=()=>{const e=(0,M.A)(),t=(0,v.Zp)(),{hasPermission:s}=q(),[a,i]=(0,n.useState)([]),[l,o]=(0,n.useState)(!0),[d,c]=(0,n.useState)(null),[x,u]=(0,n.useState)({search:"",gender:"",category:"",active:""}),[h,m]=(0,n.useState)(1),[p,A]=(0,n.useState)(1),[j,g]=(0,n.useState)(null),[y,f]=(0,n.useState)(!1);(0,n.useEffect)(()=>{b()},[h,x]);const b=async()=>{try{o(!0),c(null);let e=I.from("students").select("\n          *,\n          users!inner(*),\n          courses!inner(*)\n        ").range(h*rowsPerPage,(h+1)*rowsPerPage-1);x.search&&(e=e.or(`first_name.ilike.%${x.search}%,last_name.ilike.%${x.search}%,student_id.ilike.%${x.search}%`)),x.gender&&(e=e.eq("gender",x.gender)),x.category&&(e=e.eq("category",x.category)),void 0!==x.active&&(e=e.eq("active",x.active));const{data:t,error:s,count:r}=await e;if(s)throw s;i(t||[]),A(Math.ceil((r||0)/rowsPerPage))}catch(e){c(e.message||"Failed to load students")}finally{o(!1)}},_=(e,t)=>{u(s=>({...s,[e]:t})),m(1)};return l&&0===a.length?(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h4",gutterBottom:!0,children:"Students"}),(0,r.jsx)(ut.Ay,{container:!0,spacing:3,children:[...Array(5)].map((e,t)=>(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(Zt.A,{variant:"rectangular",height:60})},t))})]}):(0,r.jsxs)(U.A,{children:[(0,r.jsxs)(U.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(F.A,{variant:"h4",children:"Students Management"}),s("manage","students")&&(0,r.jsx)(Oe.A,{variant:"contained",startIcon:(0,r.jsx)(ns.A,{}),onClick:()=>t("/students/new"),children:"Add Student"})]}),(0,r.jsx)(ke.A,{sx:{mb:3},children:(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(We.A,{fullWidth:!0,placeholder:"Search students...",value:x.search,onChange:e=>{u(t=>({...t,search:e.target.value})),m(1)},InputProps:{startAdornment:(0,r.jsx)(as.A,{sx:{mr:1,color:"text.secondary"}})}})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:2,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Gender"}),(0,r.jsxs)(qe.A,{value:x.gender,label:"Gender",onChange:e=>_("gender",e.target.value),children:[(0,r.jsx)(B.A,{value:"",children:"All"}),(0,r.jsx)(B.A,{value:"m",children:"Male"}),(0,r.jsx)(B.A,{value:"f",children:"Female"}),(0,r.jsx)(B.A,{value:"o",children:"Other"})]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:2,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Status"}),(0,r.jsxs)(qe.A,{value:x.active,label:"Status",onChange:e=>_("active",e.target.value),children:[(0,r.jsx)(B.A,{value:"",children:"All"}),(0,r.jsx)(B.A,{value:"true",children:"Active"}),(0,r.jsx)(B.A,{value:"false",children:"Inactive"})]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:2,children:(0,r.jsx)(Oe.A,{variant:"outlined",startIcon:(0,r.jsx)(os.A,{}),onClick:()=>u({search:"",gender:"",category:"",active:""}),fullWidth:!0,children:"Clear Filters"})})]})})}),d&&(0,r.jsx)(Pe.A,{severity:"error",sx:{mb:3},onClose:()=>c(null),children:d}),(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{children:[(0,r.jsx)(Jt.A,{component:Be.A,variant:"outlined",children:(0,r.jsxs)(Yt.A,{children:[(0,r.jsx)(Xt.A,{children:(0,r.jsxs)(Vt.A,{children:[(0,r.jsx)(Gt.A,{children:"Student"}),(0,r.jsx)(Gt.A,{children:"Gender"}),(0,r.jsx)(Gt.A,{children:"Birth Date"}),(0,r.jsx)(Gt.A,{children:"Status"}),(0,r.jsx)(Gt.A,{children:"Actions"})]})}),(0,r.jsx)(Kt.A,{children:a.map(n=>(0,r.jsxs)(Vt.A,{hover:!0,children:[(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{sx:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(N.A,{sx:{mr:2,bgcolor:e.palette.primary.main},children:n.first_name?.[0]||"S"}),(0,r.jsxs)(U.A,{children:[(0,r.jsxs)(F.A,{variant:"subtitle2",children:[n.first_name," ",n.last_name]}),(0,r.jsx)(F.A,{variant:"caption",color:"text.secondary",children:n.gr_no||"No GR No"})]})]})}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:"m"===n.gender?"Male":"f"===n.gender?"Female":"Other",size:"small",color:"m"===n.gender?"primary":"f"===n.gender?"secondary":"default"})}),(0,r.jsx)(Gt.A,{children:n.birth_date?new Date(n.birth_date).toLocaleDateString():"N/A"}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:n.active?"Active":"Inactive",size:"small",color:n.active?"success":"error"})}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{sx:{display:"flex",gap:1},children:[(0,r.jsx)(Z.A,{size:"small",onClick:()=>t(`/students/${n.id}`),color:"primary",children:(0,r.jsx)(Fe.A,{})}),s("manage","students")&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Z.A,{size:"small",onClick:()=>t(`/students/${n.id}/edit`),color:"primary",children:(0,r.jsx)(is.A,{})}),(0,r.jsx)(Z.A,{size:"small",onClick:()=>{g(n),f(!0)},color:"error",children:(0,r.jsx)(ls.A,{})})]})]})})]},n.id))})]})}),p>1&&(0,r.jsx)(U.A,{sx:{display:"flex",justifyContent:"center",mt:3},children:(0,r.jsx)(Qt.A,{count:p,page:h,onChange:(e,t)=>{m(t)},color:"primary"})})]})}),(0,r.jsxs)(es.A,{open:y,onClose:()=>f(!1),children:[(0,r.jsx)(ts.A,{children:"Delete Student"}),(0,r.jsx)(ss.A,{children:(0,r.jsxs)(F.A,{children:["Are you sure you want to delete ",j?.first_name," ",j?.last_name,"? This action cannot be undone."]})}),(0,r.jsxs)(rs.A,{children:[(0,r.jsx)(Oe.A,{onClick:()=>f(!1),children:"Cancel"}),(0,r.jsx)(Oe.A,{onClick:async()=>{if(j)try{const{error:e}=await I.from("students").delete().eq("id",j.id);if(e)throw e;f(!1),g(null),b()}catch(e){c(e.message||"Failed to delete student")}},color:"error",variant:"contained",children:"Delete"})]})]})]})};var cs=s(8864),xs=s(6379),us=s(3147),hs=s(5737),ms=s(274),ps=s(9785);const As=()=>{(0,M.A)();const e=(0,v.Zp)(),{id:t}=(0,v.g)(),{hasPermission:s}=q(),[a,i]=(0,n.useState)(!1),[l,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(null),[x,u]=(0,n.useState)([]),[h,m]=(0,n.useState)([]),[p,A]=(0,n.useState)([]),[j,g]=(0,n.useState)(null),y=Boolean(t),{control:f,handleSubmit:b,formState:{errors:_,isValid:S},setValue:C,watch:w,reset:I}=(0,ps.mN)({mode:"onChange",defaultValues:{first_name:"",middle_name:"",last_name:"",birth_date:null,blood_group:"",gender:"m",nationality_id:void 0,emergency_contact_id:void 0,visa_info:"",id_number:"",gr_no:"",category_id:void 0,certificate_number:"",email:"",phone:"",active:!0}}),k=w("nationality_id");(0,n.useEffect)(()=>{E()},[t]),(0,n.useEffect)(()=>{k?T(k):m([])},[k]);const E=async()=>{try{i(!0),c(null);const[e,s]=await Promise.all([commonApi.getCountries(),commonApi.getCategories()]);if(u(e.data||[]),A(s.data||[]),y&&t){const e=(await studentApi.getStudent(parseInt(t))).data;g(e),I({first_name:e.first_name||"",middle_name:e.middle_name||"",last_name:e.last_name||"",birth_date:e.birth_date?new Date(e.birth_date):null,blood_group:e.blood_group||"",gender:e.gender||"m",nationality_id:e.nationality_id||void 0,emergency_contact_id:e.emergency_contact_id||void 0,visa_info:e.visa_info||"",id_number:e.id_number||"",gr_no:e.gr_no||"",category_id:e.category_id||void 0,certificate_number:e.certificate_number||"",email:e.user?.email||"",phone:e.user?.phone||"",active:e.active??!0})}}catch(e){const t=e instanceof Error?e.message:"Failed to load form data";c(t)}finally{i(!1)}},T=async e=>{try{const t=await commonApi.getStates(e);m(t.data||[])}catch(e){console.error("Failed to load states:",e)}};return a?(0,r.jsx)(U.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px"},children:(0,r.jsx)(Ge.A,{})}):(0,r.jsx)(hs.$,{dateAdapter:ms.h,children:(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h4",gutterBottom:!0,children:y?"Edit Student":"Add New Student"}),d&&(0,r.jsx)(Pe.A,{severity:"error",sx:{mb:3},onClose:()=>c(null),children:d}),(0,r.jsxs)("form",{onSubmit:b(async s=>{try{o(!0),c(null);const r={...s,birth_date:s.birth_date?s.birth_date.toISOString():void 0};y&&t?await studentApi.updateStudent(parseInt(t),r):await studentApi.createStudent(r),e("/students")}catch(e){const t=e instanceof Error?e.message:"Failed to save student";c(t)}finally{o(!1)}}),children:[(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{children:[(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Personal Information"}),(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"first_name",control:f,rules:{required:"First name is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"First Name",error:!!_.first_name,helperText:_.first_name?.message,required:!0})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"middle_name",control:f,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Middle Name",error:!!_.middle_name,helperText:_.middle_name?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"last_name",control:f,rules:{required:"Last name is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Last Name",error:!!_.last_name,helperText:_.last_name?.message,required:!0})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"birth_date",control:f,render:({field:e})=>(0,r.jsx)(us.l,{label:"Birth Date",value:e.value,onChange:t=>e.onChange(t),slotProps:{textField:{fullWidth:!0,error:!!_.birth_date,helperText:_.birth_date?.message}}})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"gender",control:f,rules:{required:"Gender is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,required:!0,error:!!_.gender,children:[(0,r.jsx)(Re.A,{children:"Gender"}),(0,r.jsxs)(qe.A,{...e,label:"Gender",children:[(0,r.jsx)(B.A,{value:"m",children:"Male"}),(0,r.jsx)(B.A,{value:"f",children:"Female"}),(0,r.jsx)(B.A,{value:"o",children:"Other"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"blood_group",control:f,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Blood Group",error:!!_.blood_group,helperText:_.blood_group?.message})})})]}),(0,r.jsx)(H.A,{sx:{my:3}}),(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Contact Information"}),(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"email",control:f,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Email Address",type:"email",error:!!_.email,helperText:_.email?.message,required:!0})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"phone",control:f,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Phone Number",error:!!_.phone,helperText:_.phone?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"nationality_id",control:f,render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!_.nationality_id,children:[(0,r.jsx)(Re.A,{children:"Nationality"}),(0,r.jsxs)(qe.A,{...e,label:"Nationality",children:[(0,r.jsx)(B.A,{value:"",children:"Select Nationality"}),x.map(e=>(0,r.jsx)(B.A,{value:e.id,children:e.name},e.id))]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"category_id",control:f,render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!_.category_id,children:[(0,r.jsx)(Re.A,{children:"Category"}),(0,r.jsxs)(qe.A,{...e,label:"Category",children:[(0,r.jsx)(B.A,{value:"",children:"Select Category"}),p.map(e=>(0,r.jsx)(B.A,{value:e.id,children:e.name},e.id))]})]})})})]}),(0,r.jsx)(H.A,{sx:{my:3}}),(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Academic Information"}),(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"gr_no",control:f,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"GR Number",error:!!_.gr_no,helperText:_.gr_no?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"id_number",control:f,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"ID Number",error:!!_.id_number,helperText:_.id_number?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"certificate_number",control:f,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Certificate Number",error:!!_.certificate_number,helperText:_.certificate_number?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"visa_info",control:f,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Visa Information",error:!!_.visa_info,helperText:_.visa_info?.message})})})]}),(0,r.jsx)(H.A,{sx:{my:3}}),(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Status"}),(0,r.jsx)(ut.Ay,{container:!0,spacing:3,children:(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"active",control:f,render:({field:e})=>(0,r.jsx)(cs.A,{control:(0,r.jsx)(xs.A,{checked:Boolean(e.value),onChange:t=>e.onChange(t.target.checked)}),label:"Active Student"})})})})]})}),(0,r.jsxs)(U.A,{sx:{display:"flex",gap:2,mt:3},children:[(0,r.jsx)(Oe.A,{type:"submit",variant:"contained",disabled:!S||l,startIcon:l?(0,r.jsx)(Ge.A,{size:20}):null,children:l?"Saving...":y?"Update Student":"Create Student"}),(0,r.jsx)(Oe.A,{variant:"outlined",onClick:()=>{e("/students")},disabled:l,children:"Cancel"})]})]})]})})};var js=s(3959);const gs=()=>{const e=(0,v.Zp)(),{user:t}=q(),[s,a]=(0,n.useState)([]),[i,l]=(0,n.useState)(!0),[o,d]=(0,n.useState)(null),[c,x]=(0,n.useState)(0),[u,h]=(0,n.useState)(10),[m,p]=(0,n.useState)(""),[A,j]=(0,n.useState)("all"),[g,y]=(0,n.useState)("all"),[f,b]=(0,n.useState)(!1),[_,S]=(0,n.useState)(null);(0,n.useEffect)(()=>{C()},[c,u,m,A,g]);const C=async()=>{try{l(!0);let e=I.from("faculty").select("\n          *,\n          users!inner(*),\n          departments!inner(*)\n        ").range(c*u,(c+1)*u-1);m&&(e=e.or(`first_name.ilike.%${m}%,last_name.ilike.%${m}%,employee_id.ilike.%${m}%`)),"all"!==A&&(e=e.eq("status",A)),"all"!==g&&(e=e.eq("department_id",g));const{data:t,error:s,count:r}=await e;if(s)throw s;a(t||[]),d(null)}catch(e){d("Failed to load faculty data"),console.error("Error loading faculty:",e)}finally{l(!1)}},w=e=>{switch(e){case"active":return"success";case"inactive":case"terminated":return"error";case"on_leave":return"warning";default:return"default"}},k=e=>({computer_science:"#1976d2",mathematics:"#388e3c",physics:"#f57c00",chemistry:"#7b1fa2",biology:"#388e3c",english:"#d32f2f",history:"#5d4037",economics:"#1976d2",engineering:"#f57c00",medicine:"#d32f2f"}[e]||"#757575");return i&&0===s.length?(0,r.jsx)(U.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,r.jsx)(Ge.A,{})}):(0,r.jsxs)(U.A,{sx:{p:3},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(F.A,{variant:"h4",component:"h1",children:"Faculty Management"}),(0,r.jsx)(Oe.A,{variant:"contained",startIcon:(0,r.jsx)(ns.A,{}),onClick:()=>e("/faculty/new"),disabled:!t?.permissions?.includes("faculty.create"),children:"Add Faculty"})]}),o&&(0,r.jsx)(Pe.A,{severity:"error",sx:{mb:3},children:o}),(0,r.jsx)(ke.A,{sx:{mb:3},children:(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(We.A,{fullWidth:!0,label:"Search Faculty",value:m,onChange:e=>p(e.target.value),InputProps:{startAdornment:(0,r.jsx)(as.A,{sx:{mr:1,color:"text.secondary"}})},placeholder:"Search by name, email, or employee ID..."})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Status"}),(0,r.jsxs)(qe.A,{value:A,label:"Status",onChange:e=>j(e.target.value),children:[(0,r.jsx)(B.A,{value:"all",children:"All Status"}),(0,r.jsx)(B.A,{value:"active",children:"Active"}),(0,r.jsx)(B.A,{value:"inactive",children:"Inactive"}),(0,r.jsx)(B.A,{value:"on_leave",children:"On Leave"}),(0,r.jsx)(B.A,{value:"terminated",children:"Terminated"})]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Department"}),(0,r.jsxs)(qe.A,{value:g,label:"Department",onChange:e=>y(e.target.value),children:[(0,r.jsx)(B.A,{value:"all",children:"All Departments"}),(0,r.jsx)(B.A,{value:"computer_science",children:"Computer Science"}),(0,r.jsx)(B.A,{value:"mathematics",children:"Mathematics"}),(0,r.jsx)(B.A,{value:"physics",children:"Physics"}),(0,r.jsx)(B.A,{value:"chemistry",children:"Chemistry"}),(0,r.jsx)(B.A,{value:"biology",children:"Biology"}),(0,r.jsx)(B.A,{value:"english",children:"English"}),(0,r.jsx)(B.A,{value:"history",children:"History"}),(0,r.jsx)(B.A,{value:"economics",children:"Economics"}),(0,r.jsx)(B.A,{value:"engineering",children:"Engineering"}),(0,r.jsx)(B.A,{value:"medicine",children:"Medicine"})]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:2,children:(0,r.jsx)(Oe.A,{fullWidth:!0,variant:"outlined",startIcon:(0,r.jsx)(os.A,{}),onClick:C,children:"Apply Filters"})})]})})}),(0,r.jsxs)(Be.A,{sx:{width:"100%",overflow:"hidden"},children:[(0,r.jsx)(Jt.A,{children:(0,r.jsxs)(Yt.A,{stickyHeader:!0,children:[(0,r.jsx)(Xt.A,{children:(0,r.jsxs)(Vt.A,{children:[(0,r.jsx)(Gt.A,{children:"Employee ID"}),(0,r.jsx)(Gt.A,{children:"Name"}),(0,r.jsx)(Gt.A,{children:"Email"}),(0,r.jsx)(Gt.A,{children:"Department"}),(0,r.jsx)(Gt.A,{children:"Position"}),(0,r.jsx)(Gt.A,{children:"Status"}),(0,r.jsx)(Gt.A,{children:"Join Date"}),(0,r.jsx)(Gt.A,{children:"Actions"})]})}),(0,r.jsx)(Kt.A,{children:s.map(s=>(0,r.jsxs)(Vt.A,{hover:!0,children:[(0,r.jsx)(Gt.A,{children:s.employee_id||""}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{children:[(0,r.jsxs)(F.A,{variant:"body1",fontWeight:"medium",children:[s.first_name," ",s.last_name]}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:s.qualification||""})]})}),(0,r.jsx)(Gt.A,{children:s.email||""}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:s.departments?.[0]?.name||"Unknown".replace("_"," ").toUpperCase(),size:"small",sx:{backgroundColor:k(s.departments?.[0]?.name||"computer_science")+"20",color:k(s.departments?.[0]?.name||"computer_science"),fontWeight:"medium"}})}),(0,r.jsx)(Gt.A,{children:s.position||""}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:s.status||"active".replace("_"," ").toUpperCase(),color:w(s.status||"active"),size:"small"})}),(0,r.jsx)(Gt.A,{children:new Date(s.joining_date||"").toLocaleDateString()}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{sx:{display:"flex",gap:1},children:[(0,r.jsx)(Z.A,{size:"small",onClick:()=>e(`/faculty/${s.id}`),color:"primary",children:(0,r.jsx)(Fe.A,{})}),(0,r.jsx)(Z.A,{size:"small",onClick:()=>e(`/faculty/${s.id}/edit`),color:"primary",disabled:!t?.permissions?.includes("faculty.update"),children:(0,r.jsx)(is.A,{})}),(0,r.jsx)(Z.A,{size:"small",onClick:()=>(e=>{S(e),b(!0)})(s),color:"error",disabled:!t?.permissions?.includes("faculty.delete"),children:(0,r.jsx)(ls.A,{})})]})})]},s.id))})]})}),(0,r.jsx)(js.A,{rowsPerPageOptions:[5,10,25,50],component:"div",count:s.length,rowsPerPage:u,page:c,onPageChange:(e,t)=>x(t),onRowsPerPageChange:e=>{h(parseInt(e.target.value,10)),x(0)}})]}),(0,r.jsxs)(es.A,{open:f,onClose:()=>b(!1),children:[(0,r.jsx)(ts.A,{children:"Delete Faculty Member"}),(0,r.jsx)(ss.A,{children:(0,r.jsxs)(F.A,{children:["Are you sure you want to delete"," ",(0,r.jsxs)("strong",{children:[_?.first_name," ",_?.last_name]}),"? This action cannot be undone."]})}),(0,r.jsxs)(rs.A,{children:[(0,r.jsx)(Oe.A,{onClick:()=>b(!1),children:"Cancel"}),(0,r.jsx)(Oe.A,{onClick:async()=>{if(_)try{const{error:e}=await I.from("faculty").delete().eq("id",_.id);if(e)throw e;a(s.filter(e=>e.id!==_.id)),b(!1),S(null)}catch(e){d("Failed to delete faculty member"),console.error("Error deleting faculty:",e)}},color:"error",variant:"contained",children:"Delete"})]})]})]})};var ys=s(8984),fs=s(2299),bs=s(9086),vs=s(4944),_s=s(6958);const Ss=()=>{const e=(0,v.Zp)(),{id:t}=(0,v.g)(),{user:s}=q(),[a,i]=(0,n.useState)(!1),[l,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(null),[x,u]=(0,n.useState)(null),[h,m]=(0,n.useState)([]),[p,A]=(0,n.useState)([]),[j]=(0,n.useState)([{value:"computer_science",label:"Computer Science"},{value:"mathematics",label:"Mathematics"},{value:"physics",label:"Physics"},{value:"chemistry",label:"Chemistry"},{value:"biology",label:"Biology"},{value:"english",label:"English"},{value:"history",label:"History"},{value:"economics",label:"Economics"},{value:"engineering",label:"Engineering"},{value:"medicine",label:"Medicine"}]),{control:g,handleSubmit:y,reset:f,watch:b,setValue:_,formState:{errors:S,isDirty:C}}=(0,ps.mN)({defaultValues:{employee_id:"",first_name:"",last_name:"",email:"",phone:"",date_of_birth:null,gender:"male",address:"",city:"",state:"",country:"",postal_code:"",department:"computer_science",position:"",qualification:"",specialization:"",join_date:null,salary:0,status:"active",emergency_contact_name:"",emergency_contact_phone:"",emergency_contact_relationship:"",bio:""}}),w=b("country");(0,n.useEffect)(()=>{I()},[]),(0,n.useEffect)(()=>{w&&k(w)},[w]);const I=async()=>{try{i(!0);const e=await commonApi.getCountries();if(m(e.data),t&&"new"!==t){const e=(await facultyApi.getFacultyById(parseInt(t,10))).data;u(e),f({employee_id:e.employee_id,first_name:e.first_name,last_name:e.last_name,email:e.email,phone:e.phone,date_of_birth:e.date_of_birth?new Date(e.date_of_birth):null,gender:e.gender,address:e.address,city:e.city,state:e.state,country:e.country,postal_code:e.postal_code,department:e.department,position:e.position,qualification:e.qualification,specialization:e.specialization,join_date:e.join_date?new Date(e.join_date):null,salary:e.salary,status:e.status,emergency_contact_name:e.emergency_contact_name,emergency_contact_phone:e.emergency_contact_phone,emergency_contact_relationship:e.emergency_contact_relationship,bio:e.bio,profile_picture:e.profile_picture})}}catch(e){c("Failed to load initial data"),console.error("Error loading initial data:",e)}finally{i(!1)}},k=async e=>{try{const t=await commonApi.getStates(parseInt(e));A(t.data)}catch(e){console.error("Error loading states:",e)}},E=async s=>{try{o(!0),c(null);const r={...s,date_of_birth:s.date_of_birth?.toISOString(),join_date:s.join_date?.toISOString()};t&&"new"!==t?await facultyApi.updateFaculty(parseInt(t,10),r):await facultyApi.createFaculty(r),e("/faculty")}catch(e){const t=e instanceof Error?e.message:"Failed to save faculty member";c(t),console.error("Error saving faculty:",e)}finally{o(!1)}};return a?(0,r.jsx)(U.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,r.jsx)(Ge.A,{})}):(0,r.jsx)(hs.$,{dateAdapter:ms.h,children:(0,r.jsxs)(U.A,{sx:{p:3},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(F.A,{variant:"h4",component:"h1",children:"new"===t?"Add New Faculty Member":"Edit Faculty Member"}),(0,r.jsxs)(U.A,{sx:{display:"flex",gap:2},children:[(0,r.jsx)(Oe.A,{variant:"outlined",startIcon:(0,r.jsx)(fs.A,{}),onClick:()=>e("/faculty"),children:"Cancel"}),(0,r.jsx)(Oe.A,{variant:"contained",startIcon:(0,r.jsx)(ys.A,{}),onClick:y(E),disabled:l||!C,children:l?"Saving...":"Save"})]})]}),d&&(0,r.jsx)(Pe.A,{severity:"error",sx:{mb:3},children:d}),(0,r.jsx)("form",{onSubmit:y(E),children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ke.A,{children:(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(N.A,{sx:{width:80,height:80},children:(0,r.jsx)(be.A,{})}),title:"Profile Picture",action:(0,r.jsx)(Z.A,{children:(0,r.jsx)(bs.A,{})})})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{icon:(0,r.jsx)(be.A,{}),title:"Basic Information"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"employee_id",control:g,rules:{required:"Employee ID is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Employee ID",error:!!S.employee_id,helperText:S.employee_id?.message,disabled:"new"!==t})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"first_name",control:g,rules:{required:"First name is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"First Name",error:!!S.first_name,helperText:S.first_name?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"last_name",control:g,rules:{required:"Last name is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Last Name",error:!!S.last_name,helperText:S.last_name?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"email",control:g,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Email",type:"email",error:!!S.email,helperText:S.email?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"phone",control:g,rules:{required:"Phone number is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Phone Number",error:!!S.phone,helperText:S.phone?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"date_of_birth",control:g,rules:{required:"Date of birth is required"},render:({field:e})=>(0,r.jsx)(us.l,{label:"Date of Birth",value:e.value,onChange:e.onChange,slotProps:{textField:{fullWidth:!0,error:!!S.date_of_birth,helperText:S.date_of_birth?.message}}})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"gender",control:g,rules:{required:"Gender is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!S.gender,children:[(0,r.jsx)(Re.A,{children:"Gender"}),(0,r.jsxs)(qe.A,{...e,label:"Gender",children:[(0,r.jsx)(B.A,{value:"male",children:"Male"}),(0,r.jsx)(B.A,{value:"female",children:"Female"}),(0,r.jsx)(B.A,{value:"other",children:"Other"})]})]})})})]})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{icon:(0,r.jsx)(_s.A,{}),title:"Contact Information"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"address",control:g,rules:{required:"Address is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Address",multiline:!0,rows:3,error:!!S.address,helperText:S.address?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"city",control:g,rules:{required:"City is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"City",error:!!S.city,helperText:S.city?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"state",control:g,rules:{required:"State is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!S.state,children:[(0,r.jsx)(Re.A,{children:"State"}),(0,r.jsx)(qe.A,{...e,label:"State",children:p.map(e=>(0,r.jsx)(B.A,{value:e.code,children:e.name},e.code))})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"country",control:g,rules:{required:"Country is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!S.country,children:[(0,r.jsx)(Re.A,{children:"Country"}),(0,r.jsx)(qe.A,{...e,label:"Country",children:h.map(e=>(0,r.jsx)(B.A,{value:e.code,children:e.name},e.code))})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"postal_code",control:g,rules:{required:"Postal code is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Postal Code",error:!!S.postal_code,helperText:S.postal_code?.message})})})]})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{icon:(0,r.jsx)(vs.A,{}),title:"Professional Information"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"department",control:g,rules:{required:"Department is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!S.department,children:[(0,r.jsx)(Re.A,{children:"Department"}),(0,r.jsx)(qe.A,{...e,label:"Department",children:j.map(e=>(0,r.jsx)(B.A,{value:e.value,children:e.label},e.value))})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"position",control:g,rules:{required:"Position is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Position",error:!!S.position,helperText:S.position?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"qualification",control:g,rules:{required:"Qualification is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Qualification",error:!!S.qualification,helperText:S.qualification?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"specialization",control:g,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Specialization",error:!!S.specialization,helperText:S.specialization?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"join_date",control:g,rules:{required:"Join date is required"},render:({field:e})=>(0,r.jsx)(us.l,{label:"Join Date",value:e.value,onChange:e.onChange,slotProps:{textField:{fullWidth:!0,error:!!S.join_date,helperText:S.join_date?.message}}})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"salary",control:g,rules:{required:"Salary is required",min:{value:0,message:"Salary must be positive"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Salary",type:"number",error:!!S.salary,helperText:S.salary?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"status",control:g,rules:{required:"Status is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!S.status,children:[(0,r.jsx)(Re.A,{children:"Status"}),(0,r.jsxs)(qe.A,{...e,label:"Status",children:[(0,r.jsx)(B.A,{value:"active",children:"Active"}),(0,r.jsx)(B.A,{value:"inactive",children:"Inactive"}),(0,r.jsx)(B.A,{value:"on_leave",children:"On Leave"}),(0,r.jsx)(B.A,{value:"terminated",children:"Terminated"})]})]})})})]})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{icon:(0,r.jsx)(_s.A,{}),title:"Emergency Contact"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"emergency_contact_name",control:g,rules:{required:"Emergency contact name is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Emergency Contact Name",error:!!S.emergency_contact_name,helperText:S.emergency_contact_name?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"emergency_contact_phone",control:g,rules:{required:"Emergency contact phone is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Emergency Contact Phone",error:!!S.emergency_contact_phone,helperText:S.emergency_contact_phone?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"emergency_contact_relationship",control:g,rules:{required:"Relationship is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Relationship",error:!!S.emergency_contact_relationship,helperText:S.emergency_contact_relationship?.message})})})]})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{icon:(0,r.jsx)(re.A,{}),title:"Biography"}),(0,r.jsx)(Ee.A,{children:(0,r.jsx)(ps.xI,{name:"bio",control:g,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Biography",multiline:!0,rows:4,error:!!S.bio,helperText:S.bio?.message,placeholder:"Tell us about the faculty member's background, experience, and achievements..."})})})]})})]})})]})})},Cs=()=>{const e=(0,v.Zp)(),{user:t}=q(),[s,a]=(0,n.useState)([]),[i,l]=(0,n.useState)(!0),[o,d]=(0,n.useState)(null),[c,x]=(0,n.useState)(0),[u,h]=(0,n.useState)(10),[m,p]=(0,n.useState)(""),[A,j]=(0,n.useState)("all"),[g,y]=(0,n.useState)("all"),[f,b]=(0,n.useState)(!1),[_,S]=(0,n.useState)(null);(0,n.useEffect)(()=>{C()},[c,u,m,A,g]);const C=async()=>{try{l(!0);let e=I.from("courses").select("\n          *,\n          departments!inner(*),\n          program_levels!inner(*)\n        ").range(c*u,(c+1)*u-1);m&&(e=e.or(`name.ilike.%${m}%,code.ilike.%${m}%,description.ilike.%${m}%`)),"all"!==A&&(e=e.eq("status",A)),"all"!==g&&(e=e.eq("level",g));const{data:t,error:s,count:r}=await e;if(s)throw s;a(t||[]),d(null)}catch(e){d("Failed to load courses data"),console.error("Error loading courses:",e)}finally{l(!1)}},w=e=>{switch(e){case"active":return"success";case"inactive":return"error";case"completed":return"info";case"cancelled":return"warning";default:return"default"}},k=e=>({beginner:"#4caf50",intermediate:"#ff9800",advanced:"#f44336",expert:"#9c27b0"}[e]||"#757575");return i&&0===s.length?(0,r.jsx)(U.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,r.jsx)(Ge.A,{})}):(0,r.jsxs)(U.A,{sx:{p:3},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(F.A,{variant:"h4",component:"h1",children:"Course Management"}),(0,r.jsx)(Oe.A,{variant:"contained",startIcon:(0,r.jsx)(ns.A,{}),onClick:()=>e("/courses/new"),disabled:!t?.permissions?.includes("course.create"),children:"Add Course"})]}),o&&(0,r.jsx)(Pe.A,{severity:"error",sx:{mb:3},children:o}),(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,sx:{mb:3},children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"primary.main"},children:(0,r.jsx)(re.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:s.length}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Total Courses"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"success.main"},children:(0,r.jsx)(xe.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:s.filter(e=>"active"===e.status).length}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Active Courses"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"warning.main"},children:(0,r.jsx)(de.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:s.filter(e=>"inactive"===e.status).length}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Draft Courses"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"info.main"},children:(0,r.jsx)(re.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:s.filter(e=>"completed"===e.status).length}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Completed"})]})]})})})]}),(0,r.jsx)(ke.A,{sx:{mb:3},children:(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(We.A,{fullWidth:!0,label:"Search Courses",value:m,onChange:e=>p(e.target.value),InputProps:{startAdornment:(0,r.jsx)(as.A,{sx:{mr:1,color:"text.secondary"}})},placeholder:"Search by course name, code, or description..."})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Status"}),(0,r.jsxs)(qe.A,{value:A,label:"Status",onChange:e=>j(e.target.value),children:[(0,r.jsx)(B.A,{value:"all",children:"All Status"}),(0,r.jsx)(B.A,{value:"active",children:"Active"}),(0,r.jsx)(B.A,{value:"inactive",children:"Inactive"}),(0,r.jsx)(B.A,{value:"completed",children:"Completed"})]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Level"}),(0,r.jsxs)(qe.A,{value:g,label:"Level",onChange:e=>y(e.target.value),children:[(0,r.jsx)(B.A,{value:"all",children:"All Levels"}),(0,r.jsx)(B.A,{value:"beginner",children:"Beginner"}),(0,r.jsx)(B.A,{value:"intermediate",children:"Intermediate"}),(0,r.jsx)(B.A,{value:"advanced",children:"Advanced"}),(0,r.jsx)(B.A,{value:"expert",children:"Expert"})]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:2,children:(0,r.jsx)(Oe.A,{fullWidth:!0,variant:"outlined",startIcon:(0,r.jsx)(os.A,{}),onClick:C,children:"Apply Filters"})})]})})}),(0,r.jsxs)(Be.A,{sx:{width:"100%",overflow:"hidden"},children:[(0,r.jsx)(Jt.A,{children:(0,r.jsxs)(Yt.A,{stickyHeader:!0,children:[(0,r.jsx)(Xt.A,{children:(0,r.jsxs)(Vt.A,{children:[(0,r.jsx)(Gt.A,{children:"Course Code"}),(0,r.jsx)(Gt.A,{children:"Course Name"}),(0,r.jsx)(Gt.A,{children:"Department"}),(0,r.jsx)(Gt.A,{children:"Level"}),(0,r.jsx)(Gt.A,{children:"Credits"}),(0,r.jsx)(Gt.A,{children:"Duration"}),(0,r.jsx)(Gt.A,{children:"Status"}),(0,r.jsx)(Gt.A,{children:"Enrolled"}),(0,r.jsx)(Gt.A,{children:"Actions"})]})}),(0,r.jsx)(Kt.A,{children:s.map(s=>(0,r.jsxs)(Vt.A,{hover:!0,children:[(0,r.jsx)(Gt.A,{children:(0,r.jsx)(F.A,{variant:"body1",fontWeight:"medium",children:s.code})}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"body1",fontWeight:"medium",children:s.name}),(0,r.jsxs)(F.A,{variant:"body2",color:"text.secondary",noWrap:!0,children:[s.description||""?.substring(0,50),"..."]})]})}),(0,r.jsx)(Gt.A,{children:s.department?.name||""}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:s.level||"beginner".toUpperCase(),size:"small",sx:{backgroundColor:k(s.level||"beginner")+"20",color:k(s.level||"beginner"),fontWeight:"medium"}})}),(0,r.jsx)(Gt.A,{children:s.credits||0}),(0,r.jsxs)(Gt.A,{children:[s.duration_hours||0,"h"]}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:(s.status||"active").toUpperCase(),color:w(s.status||"active"),size:"small"})}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(F.A,{variant:"body2",children:s.enrolled_students||0}),(0,r.jsxs)(F.A,{variant:"body2",color:"text.secondary",children:["/ ",s.max_students||"âˆ"]})]})}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{sx:{display:"flex",gap:1},children:[(0,r.jsx)(Z.A,{size:"small",onClick:()=>e(`/courses/${s.id}`),color:"primary",children:(0,r.jsx)(Fe.A,{})}),(0,r.jsx)(Z.A,{size:"small",onClick:()=>e(`/courses/${s.id}/edit`),color:"primary",disabled:!t?.permissions?.includes("course.update"),children:(0,r.jsx)(is.A,{})}),(0,r.jsx)(Z.A,{size:"small",onClick:()=>(e=>{S(e),b(!0)})(s),color:"error",disabled:!t?.permissions?.includes("course.delete"),children:(0,r.jsx)(ls.A,{})})]})})]},s.id))})]})}),(0,r.jsx)(js.A,{rowsPerPageOptions:[5,10,25,50],component:"div",count:s.length,rowsPerPage:u,page:c,onPageChange:(e,t)=>x(t),onRowsPerPageChange:e=>{h(parseInt(e.target.value,10)),x(0)}})]}),(0,r.jsxs)(es.A,{open:f,onClose:()=>b(!1),children:[(0,r.jsx)(ts.A,{children:"Delete Course"}),(0,r.jsx)(ss.A,{children:(0,r.jsxs)(F.A,{children:["Are you sure you want to delete the course"," ",(0,r.jsx)("strong",{children:_?.name}),"? This action cannot be undone and will affect all enrolled students."]})}),(0,r.jsxs)(rs.A,{children:[(0,r.jsx)(Oe.A,{onClick:()=>b(!1),children:"Cancel"}),(0,r.jsx)(Oe.A,{onClick:async()=>{if(_)try{const{error:e}=await I.from("courses").delete().eq("id",_.id);if(e)throw e;a(s.filter(e=>e.id!==_.id)),b(!1),S(null)}catch(e){d("Failed to delete course"),console.error("Error deleting course:",e)}},color:"error",variant:"contained",children:"Delete"})]})]})]})},ws=()=>{const e=(0,v.Zp)(),{id:t}=(0,v.g)(),{user:s}=q(),[a,i]=(0,n.useState)(!1),[l,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(null),[x,u]=(0,n.useState)(null),[h,m]=(0,n.useState)([]),[p,A]=(0,n.useState)([]),{control:j,handleSubmit:g,reset:y,watch:f,setValue:b,formState:{errors:_,isDirty:S}}=(0,ps.mN)({defaultValues:{code:"",name:"",description:"",department_id:"",level:"beginner",credits:1,duration_hours:0,max_students:50,min_students:5,prerequisites:"",syllabus:"",objectives:"",status:"draft",start_date:null,end_date:null,instructor_id:"",is_elective:!1,is_practical:!1,practical_hours:0,theory_hours:0,fee:0}}),C=f("is_practical"),w=f("department_id");(0,n.useEffect)(()=>{I()},[]),(0,n.useEffect)(()=>{w&&k(w)},[w]);const I=async()=>{try{i(!0);const e=await departmentApi.getDepartments();m(e.data);const s=await facultyApi.getCourses();if(A(s.data),t&&"new"!==t){const e=(await courseApi.getCourse(parseInt(t))).data;u(e),y({code:e.code,name:e.name,description:e.description,department_id:e.department_id,level:e.level,credits:e.credits,duration_hours:e.duration_hours,max_students:e.max_students,min_students:e.min_students,prerequisites:e.prerequisites||"",syllabus:e.syllabus||"",objectives:e.objectives||"",status:e.status,start_date:e.start_date?new Date(e.start_date):null,end_date:e.end_date?new Date(e.end_date):null,instructor_id:e.instructor_id||"",is_elective:e.is_elective||!1,is_practical:e.is_practical||!1,practical_hours:e.practical_hours||0,theory_hours:e.theory_hours||0,fee:e.fee||0})}}catch(e){c("Failed to load initial data"),console.error("Error loading initial data:",e)}finally{i(!1)}},k=async e=>{try{const t=await facultyApi.getFacultyByDepartment(parseInt(e));A(t.data)}catch(e){console.error("Error loading department faculty:",e)}},E=async s=>{try{o(!0),c(null);const r={...s,start_date:s.start_date?.toISOString(),end_date:s.end_date?.toISOString()};t&&"new"!==t?await courseApi.updateCourse(parseInt(t),r):await courseApi.createCourse(r),e("/courses")}catch(e){c(e.response?.data?.message||"Failed to save course"),console.error("Error saving course:",e)}finally{o(!1)}};return a?(0,r.jsx)(U.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,r.jsx)(Ge.A,{})}):(0,r.jsx)(hs.$,{dateAdapter:ms.h,children:(0,r.jsxs)(U.A,{sx:{p:3},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(F.A,{variant:"h4",component:"h1",children:"new"===t?"Add New Course":"Edit Course"}),(0,r.jsxs)(U.A,{sx:{display:"flex",gap:2},children:[(0,r.jsx)(Oe.A,{variant:"outlined",startIcon:(0,r.jsx)(fs.A,{}),onClick:()=>e("/courses"),children:"Cancel"}),(0,r.jsx)(Oe.A,{variant:"contained",startIcon:(0,r.jsx)(ys.A,{}),onClick:g(E),disabled:l||!S,children:l?"Saving...":"Save"})]})]}),d&&(0,r.jsx)(Pe.A,{severity:"error",sx:{mb:3},children:d}),(0,r.jsx)("form",{onSubmit:g(E),children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(re.A,{}),title:"Basic Information"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"code",control:j,rules:{required:"Course code is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Course Code",error:!!_.code,helperText:_.code?.message,placeholder:"e.g., CS101"})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"name",control:j,rules:{required:"Course name is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Course Name",error:!!_.name,helperText:_.name?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"description",control:j,rules:{required:"Description is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Description",multiline:!0,rows:3,error:!!_.description,helperText:_.description?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"department_id",control:j,rules:{required:"Department is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!_.department_id,children:[(0,r.jsx)(Re.A,{children:"Department"}),(0,r.jsx)(qe.A,{...e,label:"Department",children:h.map(e=>(0,r.jsx)(B.A,{value:e.id,children:e.name},e.id))})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"level",control:j,rules:{required:"Level is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!_.level,children:[(0,r.jsx)(Re.A,{children:"Level"}),(0,r.jsxs)(qe.A,{...e,label:"Level",children:[(0,r.jsx)(B.A,{value:"beginner",children:"Beginner"}),(0,r.jsx)(B.A,{value:"intermediate",children:"Intermediate"}),(0,r.jsx)(B.A,{value:"advanced",children:"Advanced"}),(0,r.jsx)(B.A,{value:"expert",children:"Expert"})]})]})})})]})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(oe.A,{}),title:"Course Configuration"}),(0,r.jsxs)(Ee.A,{children:[(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsx)(ps.xI,{name:"credits",control:j,rules:{required:"Credits is required",min:{value:1,message:"Minimum 1 credit"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Credits",type:"number",error:!!_.credits,helperText:_.credits?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsx)(ps.xI,{name:"duration_hours",control:j,rules:{required:"Duration is required",min:{value:1,message:"Minimum 1 hour"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Total Duration (Hours)",type:"number",error:!!_.duration_hours,helperText:_.duration_hours?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsx)(ps.xI,{name:"theory_hours",control:j,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Theory Hours",type:"number",error:!!_.theory_hours,helperText:_.theory_hours?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsx)(ps.xI,{name:"practical_hours",control:j,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Practical Hours",type:"number",error:!!_.practical_hours,helperText:_.practical_hours?.message,disabled:!C})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"min_students",control:j,rules:{required:"Minimum students is required",min:{value:1,message:"Minimum 1 student"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Minimum Students",type:"number",error:!!_.min_students,helperText:_.min_students?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"max_students",control:j,rules:{required:"Maximum students is required",min:{value:1,message:"Minimum 1 student"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Maximum Students",type:"number",error:!!_.max_students,helperText:_.max_students?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"fee",control:j,rules:{min:{value:0,message:"Fee must be positive"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Course Fee",type:"number",error:!!_.fee,helperText:_.fee?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"status",control:j,rules:{required:"Status is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!_.status,children:[(0,r.jsx)(Re.A,{children:"Status"}),(0,r.jsxs)(qe.A,{...e,label:"Status",children:[(0,r.jsx)(B.A,{value:"draft",children:"Draft"}),(0,r.jsx)(B.A,{value:"active",children:"Active"}),(0,r.jsx)(B.A,{value:"inactive",children:"Inactive"}),(0,r.jsx)(B.A,{value:"completed",children:"Completed"})]})]})})})]}),(0,r.jsx)(H.A,{sx:{my:2}}),(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"is_elective",control:j,render:({field:e})=>(0,r.jsx)(cs.A,{control:(0,r.jsx)(xs.A,{...e,checked:e.value}),label:"Elective Course"})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"is_practical",control:j,render:({field:e})=>(0,r.jsx)(cs.A,{control:(0,r.jsx)(xs.A,{...e,checked:e.value}),label:"Has Practical Component"})})})]})]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(de.A,{}),title:"Schedule & Instructor"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"start_date",control:j,render:({field:e})=>(0,r.jsx)(us.l,{label:"Start Date",value:e.value,onChange:e.onChange,slotProps:{textField:{fullWidth:!0,error:!!_.start_date,helperText:_.start_date?.message}}})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"end_date",control:j,render:({field:e})=>(0,r.jsx)(us.l,{label:"End Date",value:e.value,onChange:e.onChange,slotProps:{textField:{fullWidth:!0,error:!!_.end_date,helperText:_.end_date?.message}}})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"instructor_id",control:j,render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!_.instructor_id,children:[(0,r.jsx)(Re.A,{children:"Instructor"}),(0,r.jsxs)(qe.A,{...e,label:"Instructor",children:[(0,r.jsx)(B.A,{value:"",children:"No Instructor Assigned"}),p.map(e=>(0,r.jsxs)(B.A,{value:e.id,children:[e.first_name," ",e.last_name," - ",e.departments?.[0]?.name||"No department"]},e.id))]})]})})})]})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(xe.A,{}),title:"Course Content"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"objectives",control:j,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Course Objectives",multiline:!0,rows:4,error:!!_.objectives,helperText:_.objectives?.message,placeholder:"List the main learning objectives for this course..."})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"syllabus",control:j,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Syllabus",multiline:!0,rows:6,error:!!_.syllabus,helperText:_.syllabus?.message,placeholder:"Provide detailed syllabus content..."})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"prerequisites",control:j,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Prerequisites",multiline:!0,rows:3,error:!!_.prerequisites,helperText:_.prerequisites?.message,placeholder:"List any prerequisite courses or knowledge required..."})})})]})})]})})]})})]})})};var Is=s(8883);const ks=()=>{const e=(0,v.Zp)(),{user:t}=q(),[s,a]=(0,n.useState)([]),[i,l]=(0,n.useState)(!0),[o,d]=(0,n.useState)(null),[c,x]=(0,n.useState)(0),[u,h]=(0,n.useState)(10),[m,p]=(0,n.useState)(""),[A,j]=(0,n.useState)("all"),[g,y]=(0,n.useState)(!1),[f,b]=(0,n.useState)(null);(0,n.useEffect)(()=>{_()},[c,u,m,A]);const _=async()=>{try{l(!0);let e=I.from("departments").select("\n          *,\n          companies!inner(*)\n        ").range(c*u,(c+1)*u-1);m&&(e=e.or(`name.ilike.%${m}%,code.ilike.%${m}%,description.ilike.%${m}%`)),"all"!==A&&(e=e.eq("status",A));const{data:t,error:s,count:r}=await e;if(s)throw s;a(t||[]),d(null)}catch(e){d("Failed to load departments data"),console.error("Error loading departments:",e)}finally{l(!1)}},S=e=>{switch(e){case"active":return"success";case"inactive":return"error";default:return"default"}};return i&&0===s.length?(0,r.jsx)(U.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,r.jsx)(Ge.A,{})}):(0,r.jsxs)(U.A,{sx:{p:3},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(F.A,{variant:"h4",component:"h1",children:"Department Management"}),(0,r.jsx)(Oe.A,{variant:"contained",startIcon:(0,r.jsx)(ns.A,{}),onClick:()=>e("/departments/new"),disabled:!t?.permissions?.includes("department.create"),children:"Add Department"})]}),o&&(0,r.jsx)(Pe.A,{severity:"error",sx:{mb:3},children:o}),(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,sx:{mb:3},children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"primary.main"},children:(0,r.jsx)(Is.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:s.length}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Total Departments"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"success.main"},children:(0,r.jsx)(xe.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:s.filter(e=>"active"===e.status).length}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Active Departments"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"info.main"},children:(0,r.jsx)(be.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:s.reduce((e,t)=>e+(t.total_faculty||0),0)}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Total Faculty"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"warning.main"},children:(0,r.jsx)(re.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:s.reduce((e,t)=>e+(t.total_courses||0),0)}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Total Courses"})]})]})})})]}),(0,r.jsx)(ke.A,{sx:{mb:3},children:(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(We.A,{fullWidth:!0,label:"Search Departments",value:m,onChange:e=>p(e.target.value),InputProps:{startAdornment:(0,r.jsx)(as.A,{sx:{mr:1,color:"text.secondary"}})},placeholder:"Search by department name, code, or description..."})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Status"}),(0,r.jsxs)(qe.A,{value:A,label:"Status",onChange:e=>j(e.target.value),children:[(0,r.jsx)(B.A,{value:"all",children:"All Status"}),(0,r.jsx)(B.A,{value:"active",children:"Active"}),(0,r.jsx)(B.A,{value:"inactive",children:"Inactive"})]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsx)(Oe.A,{fullWidth:!0,variant:"outlined",startIcon:(0,r.jsx)(os.A,{}),onClick:_,children:"Apply Filters"})})]})})}),(0,r.jsxs)(Be.A,{sx:{width:"100%",overflow:"hidden"},children:[(0,r.jsx)(Jt.A,{children:(0,r.jsxs)(Yt.A,{stickyHeader:!0,children:[(0,r.jsx)(Xt.A,{children:(0,r.jsxs)(Vt.A,{children:[(0,r.jsx)(Gt.A,{children:"Code"}),(0,r.jsx)(Gt.A,{children:"Department Name"}),(0,r.jsx)(Gt.A,{children:"Head of Department"}),(0,r.jsx)(Gt.A,{children:"Faculty Count"}),(0,r.jsx)(Gt.A,{children:"Course Count"}),(0,r.jsx)(Gt.A,{children:"Student Count"}),(0,r.jsx)(Gt.A,{children:"Status"}),(0,r.jsx)(Gt.A,{children:"Established"}),(0,r.jsx)(Gt.A,{children:"Actions"})]})}),(0,r.jsx)(Kt.A,{children:s.map(s=>(0,r.jsxs)(Vt.A,{hover:!0,children:[(0,r.jsx)(Gt.A,{children:(0,r.jsx)(F.A,{variant:"body1",fontWeight:"medium",children:s.code})}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"body1",fontWeight:"medium",children:s.name}),(0,r.jsxs)(F.A,{variant:"body2",color:"text.secondary",noWrap:!0,children:[s.description||""?.substring(0,50),"..."]})]})}),(0,r.jsx)(Gt.A,{children:s.head_name?(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"body2",fontWeight:"medium",children:s.head_name||""}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:s.head_email||""})]}):(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Not Assigned"})}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:s.total_faculty||0,size:"small",color:"primary",variant:"outlined"})}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:s.total_courses||0,size:"small",color:"secondary",variant:"outlined"})}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:s.total_students||0,size:"small",color:"info",variant:"outlined"})}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:s.status||"active".toUpperCase(),color:S(s.status||"active"),size:"small"})}),(0,r.jsx)(Gt.A,{children:s.established_date?new Date(s.established_date||"").getFullYear():"N/A"}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{sx:{display:"flex",gap:1},children:[(0,r.jsx)(Z.A,{size:"small",onClick:()=>e(`/departments/${s.id}`),color:"primary",children:(0,r.jsx)(Fe.A,{})}),(0,r.jsx)(Z.A,{size:"small",onClick:()=>e(`/departments/${s.id}/edit`),color:"primary",disabled:!t?.permissions?.includes("department.update"),children:(0,r.jsx)(is.A,{})}),(0,r.jsx)(Z.A,{size:"small",onClick:()=>(e=>{b(e),y(!0)})(s),color:"error",disabled:!t?.permissions?.includes("department.delete"),children:(0,r.jsx)(ls.A,{})})]})})]},s.id))})]})}),(0,r.jsx)(js.A,{rowsPerPageOptions:[5,10,25,50],component:"div",count:s.length,rowsPerPage:u,page:c,onPageChange:(e,t)=>x(t),onRowsPerPageChange:e=>{h(parseInt(e.target.value,10)),x(0)}})]}),(0,r.jsxs)(es.A,{open:g,onClose:()=>y(!1),children:[(0,r.jsx)(ts.A,{children:"Delete Department"}),(0,r.jsx)(ss.A,{children:(0,r.jsxs)(F.A,{children:["Are you sure you want to delete the department"," ",(0,r.jsx)("strong",{children:f?.name}),"? This action cannot be undone and will affect all associated faculty, courses, and students."]})}),(0,r.jsxs)(rs.A,{children:[(0,r.jsx)(Oe.A,{onClick:()=>y(!1),children:"Cancel"}),(0,r.jsx)(Oe.A,{onClick:async()=>{if(f)try{const{error:e}=await I.from("departments").delete().eq("id",f.id);if(e)throw e;a(s.filter(e=>e.id!==f.id)),y(!1),b(null)}catch(e){d("Failed to delete department"),console.error("Error deleting department:",e)}},color:"error",variant:"contained",children:"Delete"})]})]})]})},Es=()=>{const e=(0,v.Zp)(),{id:t}=(0,v.g)(),{user:s}=q(),[a,i]=(0,n.useState)(!1),[l,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(null),[x,u]=(0,n.useState)(null),[h,m]=(0,n.useState)([]),{control:p,handleSubmit:A,reset:j,formState:{errors:g,isDirty:y}}=(0,ps.mN)({defaultValues:{code:"",name:"",description:"",head_id:"",status:"active",established_date:null,budget:0,location:"",phone:"",email:"",vision:"",mission:"",objectives:""}});(0,n.useEffect)(()=>{f()},[]);const f=async()=>{try{i(!0);const e=await facultyApi.getFaculty();if(m(e.data),t&&"new"!==t){const e=(await departmentApi.getDepartment(parseInt(t))).data;u(e),j({code:e.code,name:e.name,description:e.description,head_id:e.head_id||"",status:e.status,established_date:e.established_date?new Date(e.established_date):null,budget:e.budget||0,location:e.location||"",phone:e.phone||"",email:e.email||"",vision:e.vision||"",mission:e.mission||"",objectives:e.objectives||""})}}catch(e){c("Failed to load initial data"),console.error("Error loading initial data:",e)}finally{i(!1)}},b=async s=>{try{o(!0),c(null);const r={...s,established_date:s.established_date?.toISOString()};t&&"new"!==t?await departmentApi.updateDepartment(parseInt(t),r):await departmentApi.createDepartment(r),e("/departments")}catch(e){c(e.response?.data?.message||"Failed to save department"),console.error("Error saving department:",e)}finally{o(!1)}};return a?(0,r.jsx)(U.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,r.jsx)(Ge.A,{})}):(0,r.jsx)(hs.$,{dateAdapter:ms.h,children:(0,r.jsxs)(U.A,{sx:{p:3},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(F.A,{variant:"h4",component:"h1",children:"new"===t?"Add New Department":"Edit Department"}),(0,r.jsxs)(U.A,{sx:{display:"flex",gap:2},children:[(0,r.jsx)(Oe.A,{variant:"outlined",startIcon:(0,r.jsx)(fs.A,{}),onClick:()=>e("/departments"),children:"Cancel"}),(0,r.jsx)(Oe.A,{variant:"contained",startIcon:(0,r.jsx)(ys.A,{}),onClick:A(b),disabled:l||!y,children:l?"Saving...":"Save"})]})]}),d&&(0,r.jsx)(Pe.A,{severity:"error",sx:{mb:3},children:d}),(0,r.jsx)("form",{onSubmit:A(b),children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(Is.A,{}),title:"Basic Information"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"code",control:p,rules:{required:"Department code is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Department Code",error:!!g.code,helperText:g.code?.message,placeholder:"e.g., CSE, EEE, MECH"})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"name",control:p,rules:{required:"Department name is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Department Name",error:!!g.name,helperText:g.name?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"description",control:p,rules:{required:"Description is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Description",multiline:!0,rows:3,error:!!g.description,helperText:g.description?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"head_id",control:p,render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!g.head_id,children:[(0,r.jsx)(Re.A,{children:"Head of Department"}),(0,r.jsxs)(qe.A,{...e,label:"Head of Department",children:[(0,r.jsx)(B.A,{value:"",children:"No Head Assigned"}),h.map(e=>(0,r.jsxs)(B.A,{value:e.id,children:[e.first_name," ",e.last_name," - ",e.position||""]},e.id))]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"status",control:p,rules:{required:"Status is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!g.status,children:[(0,r.jsx)(Re.A,{children:"Status"}),(0,r.jsxs)(qe.A,{...e,label:"Status",children:[(0,r.jsx)(B.A,{value:"active",children:"Active"}),(0,r.jsx)(B.A,{value:"inactive",children:"Inactive"})]})]})})})]})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(be.A,{}),title:"Contact & Location"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"location",control:p,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Location",error:!!g.location,helperText:g.location?.message,placeholder:"Building, Floor, Room"})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"phone",control:p,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Phone Number",error:!!g.phone,helperText:g.phone?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"email",control:p,rules:{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Email",type:"email",error:!!g.email,helperText:g.email?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"established_date",control:p,render:({field:e})=>(0,r.jsx)(us.l,{label:"Established Date",value:e.value,onChange:e.onChange,slotProps:{textField:{fullWidth:!0,error:!!g.established_date,helperText:g.established_date?.message}}})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"budget",control:p,rules:{min:{value:0,message:"Budget must be positive"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Annual Budget",type:"number",error:!!g.budget,helperText:g.budget?.message,InputProps:{startAdornment:(0,r.jsx)(F.A,{sx:{mr:1},children:"$"})}})})})]})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(re.A,{}),title:"Vision, Mission & Objectives"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"vision",control:p,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Vision",multiline:!0,rows:3,error:!!g.vision,helperText:g.vision?.message,placeholder:"Department's vision statement..."})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"mission",control:p,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Mission",multiline:!0,rows:4,error:!!g.mission,helperText:g.mission?.message,placeholder:"Department's mission statement..."})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"objectives",control:p,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Objectives",multiline:!0,rows:5,error:!!g.objectives,helperText:g.objectives?.message,placeholder:"List the main objectives and goals of the department..."})})})]})})]})})]})})]})})};var Ts=s(889),Ps=s(3794);function Ds(e){const{children:t,value:s,index:n,...a}=e;return(0,r.jsx)("div",{role:"tabpanel",hidden:s!==n,id:`attendance-tabpanel-${n}`,"aria-labelledby":`attendance-tab-${n}`,...a,children:s===n&&(0,r.jsx)(U.A,{sx:{p:3},children:t})})}const Rs=()=>{const e=(0,v.Zp)(),{user:t}=useAuth(),[s,a]=(0,n.useState)([]),[i,l]=(0,n.useState)([]),[o,d]=(0,n.useState)([]),[c,x]=(0,n.useState)(!0),[u,h]=(0,n.useState)(null),[m,p]=(0,n.useState)(0),[A,j]=(0,n.useState)(10),[g,y]=(0,n.useState)(""),[f,b]=(0,n.useState)("all"),[_,S]=(0,n.useState)("all"),[C,w]=(0,n.useState)(new Date),[I,k]=(0,n.useState)(0),[E,T]=(0,n.useState)(!1),[P,D]=(0,n.useState)(null);(0,n.useEffect)(()=>{R()},[]),(0,n.useEffect)(()=>{q()},[m,A,g,f,_,C,I]);const R=async()=>{try{x(!0);const[e,t]=await Promise.all([courseApi.getCourses(),studentApi.getStudents()]);l(e.data),d(t.data)}catch(e){h("Failed to load initial data"),console.error("Error loading initial data:",e)}finally{x(!1)}},q=async()=>{try{x(!0);const e=await attendanceApi.getAttendanceRegisters({page:m+1,limit:A,search:g,status:"all"!==f?f:void 0,course_id:"all"!==_?_:void 0,date:C?.toISOString().split("T")[0],type:0===I?"daily":1===I?"class":void 0});a(e.data),h(null)}catch(e){h("Failed to load attendance data"),console.error("Error loading attendance:",e)}finally{x(!1)}},M=e=>{switch(e){case"present":return"success";case"absent":return"error";case"late":return"warning";case"excused":return"info";default:return"default"}},W=e=>{switch(e){case"present":return(0,r.jsx)(Ts.A,{});case"absent":return(0,r.jsx)(fs.A,{});case"late":return(0,r.jsx)(de.A,{});case"excused":return(0,r.jsx)(Ps.A,{});default:return(0,r.jsx)(be.A,{})}},O={total:s.length,present:s.filter(e=>"present"===e.status).length,absent:s.filter(e=>"absent"===e.status).length,late:s.filter(e=>"late"===e.status).length,excused:s.filter(e=>"excused"===e.status).length};return c&&0===s.length?(0,r.jsx)(U.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,r.jsx)(Ge.A,{})}):(0,r.jsx)(hs.$,{dateAdapter:ms.h,children:(0,r.jsxs)(U.A,{sx:{p:3},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(F.A,{variant:"h4",component:"h1",children:"Attendance Management"}),(0,r.jsx)(Oe.A,{variant:"contained",startIcon:(0,r.jsx)(ns.A,{}),onClick:()=>e("/attendance/new"),disabled:!t?.permissions?.includes("attendance.create"),children:"Mark Attendance"})]}),u&&(0,r.jsx)(Pe.A,{severity:"error",sx:{mb:3},children:u}),(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,sx:{mb:3},children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:2.4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"primary.main"},children:(0,r.jsx)(xe.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:O.total}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Total Records"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:2.4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"success.main"},children:(0,r.jsx)(Ts.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:O.present}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Present"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:2.4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"error.main"},children:(0,r.jsx)(fs.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:O.absent}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Absent"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:2.4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"warning.main"},children:(0,r.jsx)(de.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:O.late}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Late"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:2.4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"info.main"},children:(0,r.jsx)(Ps.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:O.excused}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Excused"})]})]})})})]}),(0,r.jsx)(Be.A,{sx:{mb:3},children:(0,r.jsxs)(He.A,{value:I,onChange:(e,t)=>k(t),children:[(0,r.jsx)(Ve.A,{label:(0,r.jsx)(Y.A,{badgeContent:O.total,color:"primary",children:"Daily Attendance"})}),(0,r.jsx)(Ve.A,{label:(0,r.jsx)(Y.A,{badgeContent:s.filter(e=>e.class_id).length,color:"secondary",children:"Class Attendance"})}),(0,r.jsx)(Ve.A,{label:"Reports"})]})}),(0,r.jsxs)(Ds,{value:I,index:0,children:[(0,r.jsx)(ke.A,{sx:{mb:3},children:(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsx)(We.A,{fullWidth:!0,label:"Search Students",value:g,onChange:e=>y(e.target.value),InputProps:{startAdornment:(0,r.jsx)(as.A,{sx:{mr:1,color:"text.secondary"}})},placeholder:"Search by student name or ID..."})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:2,children:(0,r.jsx)(us.l,{label:"Date",value:C,onChange:w,slotProps:{textField:{fullWidth:!0}}})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:2,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Status"}),(0,r.jsxs)(qe.A,{value:f,label:"Status",onChange:e=>b(e.target.value),children:[(0,r.jsx)(B.A,{value:"all",children:"All Status"}),(0,r.jsx)(B.A,{value:"present",children:"Present"}),(0,r.jsx)(B.A,{value:"absent",children:"Absent"}),(0,r.jsx)(B.A,{value:"late",children:"Late"}),(0,r.jsx)(B.A,{value:"excused",children:"Excused"})]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Course"}),(0,r.jsxs)(qe.A,{value:_,label:"Course",onChange:e=>S(e.target.value),children:[(0,r.jsx)(B.A,{value:"all",children:"All Courses"}),i.map(e=>(0,r.jsxs)(B.A,{value:e.id,children:[e.code," - ",e.name]},e.id))]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:2,children:(0,r.jsx)(Oe.A,{fullWidth:!0,variant:"outlined",startIcon:(0,r.jsx)(os.A,{}),onClick:q,children:"Apply"})})]})})}),(0,r.jsxs)(Be.A,{sx:{width:"100%",overflow:"hidden"},children:[(0,r.jsx)(Jt.A,{children:(0,r.jsxs)(Yt.A,{stickyHeader:!0,children:[(0,r.jsx)(Xt.A,{children:(0,r.jsxs)(Vt.A,{children:[(0,r.jsx)(Gt.A,{children:"Student"}),(0,r.jsx)(Gt.A,{children:"Course"}),(0,r.jsx)(Gt.A,{children:"Date"}),(0,r.jsx)(Gt.A,{children:"Time In"}),(0,r.jsx)(Gt.A,{children:"Time Out"}),(0,r.jsx)(Gt.A,{children:"Status"}),(0,r.jsx)(Gt.A,{children:"Remarks"}),(0,r.jsx)(Gt.A,{children:"Actions"})]})}),(0,r.jsx)(Kt.A,{children:s.map(s=>(0,r.jsxs)(Vt.A,{hover:!0,children:[(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"body1",fontWeight:"medium",children:s.student_name}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:s.student_id})]})}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"body2",fontWeight:"medium",children:s.course_code}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:s.course_name})]})}),(0,r.jsx)(Gt.A,{children:new Date(s.date).toLocaleDateString()}),(0,r.jsx)(Gt.A,{children:s.time_in?new Date(s.time_in).toLocaleTimeString():"-"}),(0,r.jsx)(Gt.A,{children:s.time_out?new Date(s.time_out).toLocaleTimeString():"-"}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{icon:W(s.status),label:s.status.toUpperCase(),color:M(s.status),size:"small"})}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(F.A,{variant:"body2",noWrap:!0,children:s.remarks||"-"})}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{sx:{display:"flex",gap:1},children:[(0,r.jsx)(Z.A,{size:"small",onClick:()=>e(`/attendance/${s.id}`),color:"primary",children:(0,r.jsx)(Fe.A,{})}),(0,r.jsx)(Z.A,{size:"small",onClick:()=>e(`/attendance/${s.id}/edit`),color:"primary",disabled:!t?.permissions?.includes("attendance.update"),children:(0,r.jsx)(is.A,{})}),(0,r.jsx)(Z.A,{size:"small",onClick:()=>(e=>{D(e),T(!0)})(s),color:"error",disabled:!t?.permissions?.includes("attendance.delete"),children:(0,r.jsx)(ls.A,{})})]})})]},s.id))})]})}),(0,r.jsx)(js.A,{rowsPerPageOptions:[5,10,25,50],component:"div",count:s.length,rowsPerPage:A,page:m,onPageChange:(e,t)=>p(t),onRowsPerPageChange:e=>{j(parseInt(e.target.value,10)),p(0)}})]})]}),(0,r.jsxs)(Ds,{value:I,index:1,children:[(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Class-wise Attendance"}),(0,r.jsx)(Pe.A,{severity:"info",sx:{mb:2},children:"Class attendance tracking for specific courses and sessions."})]}),(0,r.jsxs)(Ds,{value:I,index:2,children:[(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Attendance Reports"}),(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{children:[(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Monthly Report"}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Generate monthly attendance reports for students and courses."}),(0,r.jsx)(Oe.A,{variant:"outlined",fullWidth:!0,children:"Generate Report"})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{children:[(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Student Report"}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Individual student attendance analysis and trends."}),(0,r.jsx)(Oe.A,{variant:"outlined",fullWidth:!0,children:"View Reports"})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{children:[(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Course Report"}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Course-wise attendance statistics and patterns."}),(0,r.jsx)(Oe.A,{variant:"outlined",fullWidth:!0,children:"View Reports"})]})})})]})]}),(0,r.jsxs)(es.A,{open:E,onClose:()=>T(!1),children:[(0,r.jsx)(ts.A,{children:"Delete Attendance Record"}),(0,r.jsx)(ss.A,{children:(0,r.jsxs)(F.A,{children:["Are you sure you want to delete this attendance record for"," ",(0,r.jsx)("strong",{children:P?.student_name}),"? This action cannot be undone."]})}),(0,r.jsxs)(rs.A,{children:[(0,r.jsx)(Oe.A,{onClick:()=>T(!1),children:"Cancel"}),(0,r.jsx)(Oe.A,{onClick:async()=>{if(P)try{await attendanceApi.deleteAttendanceSheet(P.id),a(s.filter(e=>e.id!==P.id)),T(!1),D(null)}catch(e){h("Failed to delete attendance record"),console.error("Error deleting attendance:",e)}},color:"error",variant:"contained",children:"Delete"})]})]})]})})};var qs=s(9332),Ms=s(8796);const Ws=()=>{const e=(0,v.Zp)(),{id:t}=(0,v.g)(),{user:s}=q(),[a,i]=(0,n.useState)(!1),[l,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(null),[x,u]=(0,n.useState)([]),[h,m]=(0,n.useState)([]),[p,A]=(0,n.useState)([]),[j,g]=(0,n.useState)([]),[y,f]=(0,n.useState)("present"),[b,_]=(0,n.useState)(!1),{control:S,handleSubmit:C,reset:w,watch:I,setValue:k,formState:{errors:E,isDirty:T}}=(0,ps.mN)({defaultValues:{date:new Date,course_id:"",class_id:"",type:"daily",remarks:"",students:[]}}),P=I("course_id"),D=I("type");(0,n.useEffect)(()=>{R()},[]),(0,n.useEffect)(()=>{P&&(M(P),"class"===D&&W(P))},[P,D]);const R=async()=>{try{i(!0);const[e,s]=await Promise.all([courseApi.getCourses(),courseApi.getCourses()]);if(u(e.data),m(s.data),t&&"new"!==t){const e=(await attendanceApi.getAttendanceSheet(parseInt(t))).data;w({date:e.date?new Date(e.date):new Date,course_id:e.course_id||"",class_id:e.class_id||"",type:e.type||"daily",remarks:e.remarks||"",students:e.students||[]})}}catch(e){c("Failed to load initial data"),console.error("Error loading initial data:",e)}finally{i(!1)}},M=async e=>{try{const t=(await studentApi.getStudentsByCourse(parseInt(e))).data.map(e=>({student_id:e.id,student_name:`${e.first_name} ${e.last_name}`,student_number:e.student_id||e.id,status:"present",time_in:new Date,time_out:null,remarks:""}));g(t),k("students",t)}catch(e){console.error("Error loading course students:",e)}},W=async e=>{try{const t=await classApi.getByCourse(e);A(t.data)}catch(e){console.error("Error loading course classes:",e)}},O=e=>{switch(e){case"present":return"success";case"absent":return"error";case"late":return"warning";case"excused":return"info";default:return"default"}},$=e=>{switch(e){case"present":return(0,r.jsx)(Ts.A,{});case"absent":return(0,r.jsx)(fs.A,{});case"late":return(0,r.jsx)(de.A,{});case"excused":return(0,r.jsx)(Ps.A,{});default:return null}},L=async s=>{try{o(!0),c(null);const r={...s,date:s.date?.toISOString().split("T")[0],students:s.students.map(e=>({...e,time_in:e.time_in?.toISOString(),time_out:e.time_out?.toISOString()}))};t&&"new"!==t?await attendanceApi.update(parseInt(t),r):await attendanceApi.createAttendanceSheet(r),e("/attendance")}catch(e){c(e.response?.data?.message||"Failed to save attendance"),console.error("Error saving attendance:",e)}finally{o(!1)}};return a?(0,r.jsx)(U.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,r.jsx)(Ge.A,{})}):(0,r.jsx)(hs.$,{dateAdapter:ms.h,children:(0,r.jsxs)(U.A,{sx:{p:3},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(F.A,{variant:"h4",component:"h1",children:"new"===t?"Mark Attendance":"Edit Attendance"}),(0,r.jsxs)(U.A,{sx:{display:"flex",gap:2},children:[(0,r.jsx)(Oe.A,{variant:"outlined",startIcon:(0,r.jsx)(fs.A,{}),onClick:()=>e("/attendance"),children:"Cancel"}),(0,r.jsx)(Oe.A,{variant:"contained",startIcon:(0,r.jsx)(ys.A,{}),onClick:C(L),disabled:l||!T,children:l?"Saving...":"Save Attendance"})]})]}),d&&(0,r.jsx)(Pe.A,{severity:"error",sx:{mb:3},children:d}),(0,r.jsx)("form",{onSubmit:C(L),children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(qs.A,{}),title:"Attendance Details"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsx)(ps.xI,{name:"date",control:S,rules:{required:"Date is required"},render:({field:e})=>(0,r.jsx)(us.l,{label:"Date",value:e.value,onChange:e.onChange,slotProps:{textField:{fullWidth:!0,error:!!E.date,helperText:E.date?.message}}})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsx)(ps.xI,{name:"type",control:S,rules:{required:"Type is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!E.type,children:[(0,r.jsx)(Re.A,{children:"Attendance Type"}),(0,r.jsxs)(qe.A,{...e,label:"Attendance Type",children:[(0,r.jsx)(B.A,{value:"daily",children:"Daily Attendance"}),(0,r.jsx)(B.A,{value:"class",children:"Class Attendance"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsx)(ps.xI,{name:"course_id",control:S,rules:{required:"Course is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!E.course_id,children:[(0,r.jsx)(Re.A,{children:"Course"}),(0,r.jsx)(qe.A,{...e,label:"Course",children:x.map(e=>(0,r.jsxs)(B.A,{value:e.id,children:[e.code," - ",e.name]},e.id))})]})})}),"class"===D&&(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:3,children:(0,r.jsx)(ps.xI,{name:"class_id",control:S,render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!E.class_id,children:[(0,r.jsx)(Re.A,{children:"Class Session"}),(0,r.jsx)(qe.A,{...e,label:"Class Session",children:p.map(e=>(0,r.jsxs)(B.A,{value:e.id,children:[e.name," - ",e.schedule]},e.id))})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"remarks",control:S,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"General Remarks",multiline:!0,rows:2,error:!!E.remarks,helperText:E.remarks?.message,placeholder:"Any general notes about this attendance session..."})})})]})})]})}),j.length>0&&(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(xe.A,{}),title:"Student Attendance",action:(0,r.jsx)(cs.A,{control:(0,r.jsx)(xs.A,{checked:b,onChange:e=>_(e.target.checked)}),label:"Bulk Mode"})}),(0,r.jsxs)(Ee.A,{children:[b&&(0,r.jsxs)(U.A,{sx:{mb:2},children:[(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Bulk Status"}),(0,r.jsxs)(qe.A,{value:y,label:"Bulk Status",onChange:e=>f(e.target.value),children:[(0,r.jsx)(B.A,{value:"present",children:"Present"}),(0,r.jsx)(B.A,{value:"absent",children:"Absent"}),(0,r.jsx)(B.A,{value:"late",children:"Late"}),(0,r.jsx)(B.A,{value:"excused",children:"Excused"})]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(Oe.A,{variant:"outlined",onClick:()=>{const e=j.map(e=>({...e,status:y,time_in:"present"===y||"late"===y?new Date:e.time_in}));g(e),k("students",e)},fullWidth:!0,children:"Apply to All Students"})})]}),(0,r.jsx)(H.A,{sx:{my:2}})]}),(0,r.jsx)(Jt.A,{children:(0,r.jsxs)(Yt.A,{children:[(0,r.jsx)(Xt.A,{children:(0,r.jsxs)(Vt.A,{children:[(0,r.jsx)(Gt.A,{children:"Student"}),(0,r.jsx)(Gt.A,{children:"Status"}),(0,r.jsx)(Gt.A,{children:"Time In"}),(0,r.jsx)(Gt.A,{children:"Time Out"}),(0,r.jsx)(Gt.A,{children:"Remarks"})]})}),(0,r.jsx)(Kt.A,{children:j.map((e,t)=>(0,r.jsxs)(Vt.A,{children:[(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"body1",fontWeight:"medium",children:e.student_name}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:e.student_number})]})}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(De.A,{size:"small",sx:{minWidth:120},children:(0,r.jsxs)(qe.A,{value:e.status,onChange:e=>((e,t)=>{const s=[...j];s[e].status=t,"present"!==t&&"late"!==t||(s[e].time_in=new Date),g(s),k("students",s)})(t,e.target.value),renderValue:e=>(0,r.jsx)(z.A,{icon:$(e)||void 0,label:e.toUpperCase(),color:O(e),size:"small"}),children:[(0,r.jsx)(B.A,{value:"present",children:(0,r.jsxs)(U.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(Ts.A,{color:"success"}),"Present"]})}),(0,r.jsx)(B.A,{value:"absent",children:(0,r.jsxs)(U.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(fs.A,{color:"error"}),"Absent"]})}),(0,r.jsx)(B.A,{value:"late",children:(0,r.jsxs)(U.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(de.A,{color:"warning"}),"Late"]})}),(0,r.jsx)(B.A,{value:"excused",children:(0,r.jsxs)(U.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(Ps.A,{color:"info"}),"Excused"]})})]})})}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(Ms.A,{label:"Time In",value:e.time_in,onChange:e=>{const s=[...j];s[t].time_in=e,g(s),k("students",s)},slotProps:{textField:{size:"small",disabled:"absent"===e.status}}})}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(Ms.A,{label:"Time Out",value:e.time_out,onChange:e=>{const s=[...j];s[t].time_out=e,g(s),k("students",s)},slotProps:{textField:{size:"small",disabled:"absent"===e.status}}})}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(We.A,{size:"small",placeholder:"Remarks...",value:e.remarks,onChange:e=>{const s=[...j];s[t].remarks=e.target.value,g(s),k("students",s)}})})]},e.student_id))})]})})]})]})})]})})]})})};function Os(e){const{children:t,value:s,index:n,...a}=e;return(0,r.jsx)("div",{role:"tabpanel",hidden:s!==n,id:`exam-tabpanel-${n}`,"aria-labelledby":`exam-tab-${n}`,...a,children:s===n&&(0,r.jsx)(U.A,{sx:{p:3},children:t})})}const Fs=()=>{const e=(0,v.Zp)(),{user:t}=useAuth(),[s,a]=(0,n.useState)([]),[i,l]=(0,n.useState)([]),[o,d]=(0,n.useState)(!0),[c,x]=(0,n.useState)(null),[u,h]=(0,n.useState)(0),[m,p]=(0,n.useState)(10),[A,j]=(0,n.useState)(""),[g,y]=(0,n.useState)("all"),[f,b]=(0,n.useState)("all"),[_,S]=(0,n.useState)("all"),[C,w]=(0,n.useState)(null),[k,E]=(0,n.useState)(0),[T,P]=(0,n.useState)(!1),[D,R]=(0,n.useState)(null);(0,n.useEffect)(()=>{q()},[]),(0,n.useEffect)(()=>{M()},[u,m,A,g,f,_,C,k]);const q=async()=>{try{d(!0);const{data:e,error:t}=await I.from("courses").select("*").eq("active",!0);if(t)throw t;l(e||[])}catch(e){x("Failed to load initial data"),console.error("Error loading initial data:",e)}finally{d(!1)}},M=async()=>{try{d(!0);let e=I.from("exam_sessions").select("\n          *,\n          courses!inner(*)\n        ").range(u*m,(u+1)*m-1);A&&(e=e.or(`name.ilike.%${A}%,description.ilike.%${A}%`)),"all"!==g&&(e=e.eq("status",g)),"all"!==f&&(e=e.eq("type",f)),"all"!==_&&(e=e.eq("course_id",_)),C&&(e=e.eq("exam_date",C.toISOString().split("T")[0]));const{data:t,error:s,count:r}=await e;if(s)throw s;a(t||[]),x(null)}catch(e){x("Failed to load exams data"),console.error("Error loading exams:",e)}finally{d(!1)}},W=e=>{switch(e){case"scheduled":return"info";case"ongoing":return"warning";case"completed":return"success";case"cancelled":return"error";default:return"default"}},O=e=>({midterm:"#1976d2",final:"#d32f2f",quiz:"#388e3c",assignment:"#f57c00",practical:"#7b1fa2",viva:"#00796b"}[e]||"#757575"),$={total:s.length,scheduled:s.filter(e=>"scheduled"===e.status).length,ongoing:s.filter(e=>"ongoing"===e.status).length,completed:s.filter(e=>"completed"===e.status).length,cancelled:s.filter(e=>"cancelled"===e.status).length};return o&&0===s.length?(0,r.jsx)(U.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,r.jsx)(Ge.A,{})}):(0,r.jsx)(hs.$,{dateAdapter:ms.h,children:(0,r.jsxs)(U.A,{sx:{p:3},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(F.A,{variant:"h4",component:"h1",children:"Exam Management"}),(0,r.jsx)(Oe.A,{variant:"contained",startIcon:(0,r.jsx)(ns.A,{}),onClick:()=>e("/exams/new"),disabled:!t?.permissions?.includes("exam.create"),children:"Schedule Exam"})]}),c&&(0,r.jsx)(Pe.A,{severity:"error",sx:{mb:3},children:c}),(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,sx:{mb:3},children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:2.4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"primary.main"},children:(0,r.jsx)(oe.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:$.total}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Total Exams"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:2.4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"info.main"},children:(0,r.jsx)(de.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:$.scheduled}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Scheduled"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:2.4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"warning.main"},children:(0,r.jsx)(ae.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:$.ongoing}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Ongoing"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:2.4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"success.main"},children:(0,r.jsx)(kt.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:$.completed}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Completed"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,sm:6,md:2.4,children:(0,r.jsx)(ke.A,{children:(0,r.jsxs)(Ee.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(N.A,{sx:{bgcolor:"error.main"},children:(0,r.jsx)(oe.A,{})}),(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"h6",children:$.cancelled}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:"Cancelled"})]})]})})})]}),(0,r.jsx)(Be.A,{sx:{mb:3},children:(0,r.jsxs)(He.A,{value:k,onChange:(e,t)=>E(t),children:[(0,r.jsx)(Ve.A,{label:(0,r.jsx)(Y.A,{badgeContent:$.total,color:"primary",children:"All Exams"})}),(0,r.jsx)(Ve.A,{label:(0,r.jsx)(Y.A,{badgeContent:$.scheduled,color:"info",children:"Scheduled"})}),(0,r.jsx)(Ve.A,{label:(0,r.jsx)(Y.A,{badgeContent:$.ongoing,color:"warning",children:"Ongoing"})}),(0,r.jsx)(Ve.A,{label:(0,r.jsx)(Y.A,{badgeContent:$.completed,color:"success",children:"Completed"})})]})}),(0,r.jsxs)(Os,{value:k,index:0,children:[(0,r.jsx)(ke.A,{sx:{mb:3},children:(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:2.5,children:(0,r.jsx)(We.A,{fullWidth:!0,label:"Search Exams",value:A,onChange:e=>j(e.target.value),InputProps:{startAdornment:(0,r.jsx)(as.A,{sx:{mr:1,color:"text.secondary"}})},placeholder:"Search by exam name or code..."})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:2,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Status"}),(0,r.jsxs)(qe.A,{value:g,label:"Status",onChange:e=>y(e.target.value),children:[(0,r.jsx)(B.A,{value:"all",children:"All Status"}),(0,r.jsx)(B.A,{value:"draft",children:"Draft"}),(0,r.jsx)(B.A,{value:"scheduled",children:"Scheduled"}),(0,r.jsx)(B.A,{value:"ongoing",children:"Ongoing"}),(0,r.jsx)(B.A,{value:"completed",children:"Completed"}),(0,r.jsx)(B.A,{value:"cancelled",children:"Cancelled"})]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:2,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Type"}),(0,r.jsxs)(qe.A,{value:f,label:"Type",onChange:e=>b(e.target.value),children:[(0,r.jsx)(B.A,{value:"all",children:"All Types"}),(0,r.jsx)(B.A,{value:"midterm",children:"Midterm"}),(0,r.jsx)(B.A,{value:"final",children:"Final"}),(0,r.jsx)(B.A,{value:"quiz",children:"Quiz"}),(0,r.jsx)(B.A,{value:"assignment",children:"Assignment"}),(0,r.jsx)(B.A,{value:"practical",children:"Practical"}),(0,r.jsx)(B.A,{value:"viva",children:"Viva"})]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:2.5,children:(0,r.jsxs)(De.A,{fullWidth:!0,children:[(0,r.jsx)(Re.A,{children:"Course"}),(0,r.jsxs)(qe.A,{value:_,label:"Course",onChange:e=>S(e.target.value),children:[(0,r.jsx)(B.A,{value:"all",children:"All Courses"}),i.map(e=>(0,r.jsxs)(B.A,{value:e.id,children:[e.code," - ",e.name]},e.id))]})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:1.5,children:(0,r.jsx)(us.l,{label:"Date",value:C,onChange:w,slotProps:{textField:{fullWidth:!0,size:"small"}}})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:1.5,children:(0,r.jsx)(Oe.A,{fullWidth:!0,variant:"outlined",startIcon:(0,r.jsx)(os.A,{}),onClick:M,children:"Apply"})})]})})}),(0,r.jsxs)(Be.A,{sx:{width:"100%",overflow:"hidden"},children:[(0,r.jsx)(Jt.A,{children:(0,r.jsxs)(Yt.A,{stickyHeader:!0,children:[(0,r.jsx)(Xt.A,{children:(0,r.jsxs)(Vt.A,{children:[(0,r.jsx)(Gt.A,{children:"Exam"}),(0,r.jsx)(Gt.A,{children:"Course"}),(0,r.jsx)(Gt.A,{children:"Type"}),(0,r.jsx)(Gt.A,{children:"Date & Time"}),(0,r.jsx)(Gt.A,{children:"Duration"}),(0,r.jsx)(Gt.A,{children:"Total Marks"}),(0,r.jsx)(Gt.A,{children:"Students"}),(0,r.jsx)(Gt.A,{children:"Status"}),(0,r.jsx)(Gt.A,{children:"Actions"})]})}),(0,r.jsx)(Kt.A,{children:s.map(s=>(0,r.jsxs)(Vt.A,{hover:!0,children:[(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"body1",fontWeight:"medium",children:s.name}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:s.code||""})]})}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"body2",fontWeight:"medium",children:s.course_code||""}),(0,r.jsx)(F.A,{variant:"body2",color:"text.secondary",children:s.course_name||""})]})}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:String(s.type||"midterm").toUpperCase(),size:"small",sx:{backgroundColor:O(String(s.type||"midterm"))+"20",color:O(String(s.type||"midterm")),fontWeight:"medium"}})}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{children:[(0,r.jsx)(F.A,{variant:"body2",fontWeight:"medium",children:new Date(s.exam_date||"").toLocaleDateString()}),(0,r.jsxs)(F.A,{variant:"body2",color:"text.secondary",children:[s.start_time," - ",s.end_time]})]})}),(0,r.jsxs)(Gt.A,{children:[s.duration||0," min"]}),(0,r.jsx)(Gt.A,{children:s.total_marks}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:s.enrolled_students||0,size:"small",color:"primary",variant:"outlined"})}),(0,r.jsx)(Gt.A,{children:(0,r.jsx)(z.A,{label:s.status||"scheduled".toUpperCase(),color:W(s.status||"scheduled"),size:"small"})}),(0,r.jsx)(Gt.A,{children:(0,r.jsxs)(U.A,{sx:{display:"flex",gap:1},children:[(0,r.jsx)(Z.A,{size:"small",onClick:()=>e(`/exams/${s.id}`),color:"primary",children:(0,r.jsx)(Fe.A,{})}),(0,r.jsx)(Z.A,{size:"small",onClick:()=>e(`/exams/${s.id}/edit`),color:"primary",disabled:!t?.permissions?.includes("exam.update"),children:(0,r.jsx)(is.A,{})}),(0,r.jsx)(Z.A,{size:"small",onClick:()=>(e=>{R(e),P(!0)})(s),color:"error",disabled:!t?.permissions?.includes("exam.delete"),children:(0,r.jsx)(ls.A,{})})]})})]},s.id))})]})}),(0,r.jsx)(js.A,{rowsPerPageOptions:[5,10,25,50],component:"div",count:s.length,rowsPerPage:m,page:u,onPageChange:(e,t)=>h(t),onRowsPerPageChange:e=>{p(parseInt(e.target.value,10)),h(0)}})]})]}),(0,r.jsxs)(Os,{value:k,index:1,children:[(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Scheduled Exams"}),(0,r.jsx)(Pe.A,{severity:"info",sx:{mb:2},children:"Exams that are scheduled but not yet started."})]}),(0,r.jsxs)(Os,{value:k,index:2,children:[(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Ongoing Exams"}),(0,r.jsx)(Pe.A,{severity:"warning",sx:{mb:2},children:"Exams currently in progress."})]}),(0,r.jsxs)(Os,{value:k,index:3,children:[(0,r.jsx)(F.A,{variant:"h6",gutterBottom:!0,children:"Completed Exams"}),(0,r.jsx)(Pe.A,{severity:"success",sx:{mb:2},children:"Exams that have been completed and results are available."})]}),(0,r.jsxs)(es.A,{open:T,onClose:()=>P(!1),children:[(0,r.jsx)(ts.A,{children:"Delete Exam"}),(0,r.jsx)(ss.A,{children:(0,r.jsxs)(F.A,{children:["Are you sure you want to delete the exam"," ",(0,r.jsx)("strong",{children:D?.name}),"? This action cannot be undone and will affect all associated results and data."]})}),(0,r.jsxs)(rs.A,{children:[(0,r.jsx)(Oe.A,{onClick:()=>P(!1),children:"Cancel"}),(0,r.jsx)(Oe.A,{onClick:async()=>{if(D)try{const{error:e}=await I.from("exam_sessions").delete().eq("id",D.id);if(e)throw e;a(s.filter(e=>e.id!==D.id)),P(!1),R(null)}catch(e){x("Failed to delete exam"),console.error("Error deleting exam:",e)}},color:"error",variant:"contained",children:"Delete"})]})]})]})})},$s=()=>{const e=(0,v.Zp)(),{id:t}=(0,v.g)(),{user:s}=q(),[a,i]=(0,n.useState)(!1),[l,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(null),[x,u]=(0,n.useState)(null),[h,m]=(0,n.useState)([]),[p,A]=(0,n.useState)([]),{control:j,handleSubmit:g,reset:y,watch:f,setValue:b,formState:{errors:_,isDirty:S}}=(0,ps.mN)({defaultValues:{name:"",code:"",description:"",course_id:"",type:"midterm",status:"draft",exam_date:null,start_time:null,end_time:null,duration:60,total_marks:100,passing_marks:40,instructions:"",venue:"",supervisor_id:"",is_online:!1,online_platform:"",online_link:"",allow_calculator:!1,allow_notes:!1,negative_marking:!1,negative_marks_per_question:0}}),C=f("is_online"),w=f("negative_marking");(0,n.useEffect)(()=>{I()},[]);const I=async()=>{try{i(!0);const[e,s]=await Promise.all([courseApi.getCourses(),facultyApi.getFaculty()]);if(m(e.data),A(s.data),t&&"new"!==t){const e=(await examApi.getExam(parseInt(t))).data;u(e),y({name:e.name,code:e.code,description:e.description,course_id:e.course_id,type:e.type,status:e.status,exam_date:e.exam_date?new Date(e.exam_date):null,start_time:e.start_time?new Date(`2000-01-01T${e.start_time}`):null,end_time:e.end_time?new Date(`2000-01-01T${e.end_time}`):null,duration:e.duration,total_marks:e.total_marks,passing_marks:e.passing_marks,instructions:e.instructions||"",venue:e.venue||"",supervisor_id:e.supervisor_id||"",is_online:e.is_online||!1,online_platform:e.online_platform||"",online_link:e.online_link||"",allow_calculator:e.allow_calculator||!1,allow_notes:e.allow_notes||!1,negative_marking:e.negative_marking||!1,negative_marks_per_question:e.negative_marks_per_question||0})}}catch(e){c("Failed to load initial data"),console.error("Error loading initial data:",e)}finally{i(!1)}},k=async s=>{try{o(!0),c(null);const r={...s,exam_date:s.exam_date?.toISOString().split("T")[0],start_time:s.start_time?.toTimeString().split(" ")[0].substring(0,5),end_time:s.end_time?.toTimeString().split(" ")[0].substring(0,5)};t&&"new"!==t?await examApi.updateExam(parseInt(t),r):await examApi.createExam(r),e("/exams")}catch(e){c(e.response?.data?.message||"Failed to save exam"),console.error("Error saving exam:",e)}finally{o(!1)}};return a?(0,r.jsx)(U.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,r.jsx)(Ge.A,{})}):(0,r.jsx)(hs.$,{dateAdapter:ms.h,children:(0,r.jsxs)(U.A,{sx:{p:3},children:[(0,r.jsxs)(U.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(F.A,{variant:"h4",component:"h1",children:"new"===t?"Schedule New Exam":"Edit Exam"}),(0,r.jsxs)(U.A,{sx:{display:"flex",gap:2},children:[(0,r.jsx)(Oe.A,{variant:"outlined",startIcon:(0,r.jsx)(fs.A,{}),onClick:()=>e("/exams"),children:"Cancel"}),(0,r.jsx)(Oe.A,{variant:"contained",startIcon:(0,r.jsx)(ys.A,{}),onClick:g(k),disabled:l||!S,children:l?"Saving...":"Save Exam"})]})]}),d&&(0,r.jsx)(Pe.A,{severity:"error",sx:{mb:3},children:d}),(0,r.jsx)("form",{onSubmit:g(k),children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:3,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(oe.A,{}),title:"Basic Information"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"name",control:j,rules:{required:"Exam name is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Exam Name",error:!!_.name,helperText:_.name?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"code",control:j,rules:{required:"Exam code is required"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Exam Code",error:!!_.code,helperText:_.code?.message,placeholder:"e.g., MID-CS101-2024"})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"description",control:j,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Description",multiline:!0,rows:3,error:!!_.description,helperText:_.description?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"course_id",control:j,rules:{required:"Course is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!_.course_id,children:[(0,r.jsx)(Re.A,{children:"Course"}),(0,r.jsx)(qe.A,{...e,label:"Course",children:h.map(e=>(0,r.jsxs)(B.A,{value:e.id,children:[e.code," - ",e.name]},e.id))})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"type",control:j,rules:{required:"Exam type is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!_.type,children:[(0,r.jsx)(Re.A,{children:"Exam Type"}),(0,r.jsxs)(qe.A,{...e,label:"Exam Type",children:[(0,r.jsx)(B.A,{value:"midterm",children:"Midterm"}),(0,r.jsx)(B.A,{value:"final",children:"Final"}),(0,r.jsx)(B.A,{value:"quiz",children:"Quiz"}),(0,r.jsx)(B.A,{value:"assignment",children:"Assignment"}),(0,r.jsx)(B.A,{value:"practical",children:"Practical"}),(0,r.jsx)(B.A,{value:"viva",children:"Viva"})]})]})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"status",control:j,rules:{required:"Status is required"},render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!_.status,children:[(0,r.jsx)(Re.A,{children:"Status"}),(0,r.jsxs)(qe.A,{...e,label:"Status",children:[(0,r.jsx)(B.A,{value:"draft",children:"Draft"}),(0,r.jsx)(B.A,{value:"scheduled",children:"Scheduled"}),(0,r.jsx)(B.A,{value:"ongoing",children:"Ongoing"}),(0,r.jsx)(B.A,{value:"completed",children:"Completed"}),(0,r.jsx)(B.A,{value:"cancelled",children:"Cancelled"})]})]})})})]})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(de.A,{}),title:"Schedule & Timing"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"exam_date",control:j,rules:{required:"Exam date is required"},render:({field:e})=>(0,r.jsx)(us.l,{label:"Exam Date",value:e.value,onChange:e.onChange,slotProps:{textField:{fullWidth:!0,error:!!_.exam_date,helperText:_.exam_date?.message}}})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"start_time",control:j,rules:{required:"Start time is required"},render:({field:e})=>(0,r.jsx)(Ms.A,{label:"Start Time",value:e.value,onChange:e.onChange,slotProps:{textField:{fullWidth:!0,error:!!_.start_time,helperText:_.start_time?.message}}})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(ps.xI,{name:"end_time",control:j,rules:{required:"End time is required"},render:({field:e})=>(0,r.jsx)(Ms.A,{label:"End Time",value:e.value,onChange:e.onChange,slotProps:{textField:{fullWidth:!0,error:!!_.end_time,helperText:_.end_time?.message}}})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"duration",control:j,rules:{required:"Duration is required",min:{value:1,message:"Minimum 1 minute"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Duration (minutes)",type:"number",error:!!_.duration,helperText:_.duration?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"supervisor_id",control:j,render:({field:e})=>(0,r.jsxs)(De.A,{fullWidth:!0,error:!!_.supervisor_id,children:[(0,r.jsx)(Re.A,{children:"Supervisor"}),(0,r.jsxs)(qe.A,{...e,label:"Supervisor",children:[(0,r.jsx)(B.A,{value:"",children:"No Supervisor Assigned"}),p.map(e=>(0,r.jsxs)(B.A,{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]})})})]})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(kt.A,{}),title:"Grading & Marks"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"total_marks",control:j,rules:{required:"Total marks is required",min:{value:1,message:"Minimum 1 mark"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Total Marks",type:"number",error:!!_.total_marks,helperText:_.total_marks?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"passing_marks",control:j,rules:{required:"Passing marks is required",min:{value:0,message:"Cannot be negative"}},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Passing Marks",type:"number",error:!!_.passing_marks,helperText:_.passing_marks?.message})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"negative_marking",control:j,render:({field:e})=>(0,r.jsx)(cs.A,{control:(0,r.jsx)(xs.A,{...e,checked:e.value}),label:"Negative Marking"})})}),w&&(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"negative_marks_per_question",control:j,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Negative Marks per Wrong Answer",type:"number",error:!!_.negative_marks_per_question,helperText:_.negative_marks_per_question?.message})})})]})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{avatar:(0,r.jsx)(xe.A,{}),title:"Venue & Platform"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"is_online",control:j,render:({field:e})=>(0,r.jsx)(cs.A,{control:(0,r.jsx)(xs.A,{...e,checked:e.value}),label:"Online Exam"})})}),C?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"online_platform",control:j,rules:{required:"Online platform is required for online exams"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Online Platform",error:!!_.online_platform,helperText:_.online_platform?.message,placeholder:"Zoom, Google Meet, Teams, etc."})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"online_link",control:j,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Online Link",error:!!_.online_link,helperText:_.online_link?.message,placeholder:"Meeting/exam link"})})})]}):(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"venue",control:j,rules:{required:"Venue is required for offline exams"},render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Venue",error:!!_.venue,helperText:_.venue?.message,placeholder:"Room number, building, etc."})})})]})})]})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsxs)(ke.A,{children:[(0,r.jsx)(ft.A,{title:"Rules & Instructions"}),(0,r.jsx)(Ee.A,{children:(0,r.jsxs)(ut.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"allow_calculator",control:j,render:({field:e})=>(0,r.jsx)(cs.A,{control:(0,r.jsx)(xs.A,{...e,checked:e.value}),label:"Allow Calculator"})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(ps.xI,{name:"allow_notes",control:j,render:({field:e})=>(0,r.jsx)(cs.A,{control:(0,r.jsx)(xs.A,{...e,checked:e.value}),label:"Allow Notes/Books"})})}),(0,r.jsx)(ut.Ay,{item:!0,xs:12,children:(0,r.jsx)(ps.xI,{name:"instructions",control:j,render:({field:e})=>(0,r.jsx)(We.A,{...e,fullWidth:!0,label:"Exam Instructions",multiline:!0,rows:5,error:!!_.instructions,helperText:_.instructions?.message,placeholder:"Detailed instructions for students..."})})})]})})]})})]})})]})})},Ls=({children:e})=>{const{isAuthenticated:t,isLoading:s}=q();return s?(0,r.jsx)("div",{children:"Loading..."}):t?(0,r.jsx)(Ie,{children:e}):(0,r.jsx)(v.C5,{to:"/login",replace:!0})},Us=()=>(0,r.jsxs)(v.BV,{children:[(0,r.jsx)(v.qh,{path:"/login",element:(0,r.jsx)(Ne,{})}),(0,r.jsx)(v.qh,{path:"/mfa",element:(0,r.jsx)(xt,{})}),(0,r.jsx)(v.qh,{path:"/",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Ht,{})})}),(0,r.jsx)(v.qh,{path:"/dashboard",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Ht,{})})}),(0,r.jsx)(v.qh,{path:"/students",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(ds,{})})}),(0,r.jsx)(v.qh,{path:"/students/new",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(As,{})})}),(0,r.jsx)(v.qh,{path:"/students/:id",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(As,{})})}),(0,r.jsx)(v.qh,{path:"/students/:id/edit",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(As,{})})}),(0,r.jsx)(v.qh,{path:"/faculty",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(gs,{})})}),(0,r.jsx)(v.qh,{path:"/faculty/new",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Ss,{})})}),(0,r.jsx)(v.qh,{path:"/faculty/:id",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Ss,{})})}),(0,r.jsx)(v.qh,{path:"/faculty/:id/edit",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Ss,{})})}),(0,r.jsx)(v.qh,{path:"/courses",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Cs,{})})}),(0,r.jsx)(v.qh,{path:"/courses/new",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(ws,{})})}),(0,r.jsx)(v.qh,{path:"/courses/:id",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(ws,{})})}),(0,r.jsx)(v.qh,{path:"/courses/:id/edit",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(ws,{})})}),(0,r.jsx)(v.qh,{path:"/departments",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(ks,{})})}),(0,r.jsx)(v.qh,{path:"/departments/new",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Es,{})})}),(0,r.jsx)(v.qh,{path:"/departments/:id",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Es,{})})}),(0,r.jsx)(v.qh,{path:"/departments/:id/edit",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Es,{})})}),(0,r.jsx)(v.qh,{path:"/attendance",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Rs,{})})}),(0,r.jsx)(v.qh,{path:"/attendance/new",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Ws,{})})}),(0,r.jsx)(v.qh,{path:"/attendance/:id",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Ws,{})})}),(0,r.jsx)(v.qh,{path:"/attendance/:id/edit",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Ws,{})})}),(0,r.jsx)(v.qh,{path:"/exams",element:(0,r.jsx)(Ls,{children:(0,r.jsx)(Fs,{})})}),(0,r.jsx)(v.qh,{path:"/exams/new",element:(0,r.jsx)(Ls,{children:(0,r.jsx)($s,{})})}),(0,r.jsx)(v.qh,{path:"/exams/:id",element:(0,r.jsx)(Ls,{children:(0,r.jsx)($s,{})})}),(0,r.jsx)(v.qh,{path:"/exams/:id/edit",element:(0,r.jsx)(Ls,{children:(0,r.jsx)($s,{})})})]});var Ns=s(5072),zs=s.n(Ns),Bs=s(7825),Hs=s.n(Bs),Vs=s(7659),Gs=s.n(Vs),Zs=s(5056),Js=s.n(Zs),Ys=s(540),Xs=s.n(Ys),Ks=s(1113),Qs=s.n(Ks),er=s(6523),tr={};tr.styleTagTransform=Qs(),tr.setAttributes=Js(),tr.insert=Gs().bind(null,"head"),tr.domAPI=Hs(),tr.insertStyleElement=Xs(),zs()(er.A,tr),er.A&&er.A.locals&&er.A.locals,b.useSupabaseAuth&&b.url&&b.anonKey?(()=>{const e=[];b.url||e.push("REACT_APP_SUPABASE_URL is required"),b.anonKey||e.push("REACT_APP_SUPABASE_ANON_KEY is required"),e.length>0?console.error("âŒ Supabase configuration errors:",e):console.log("âœ… Supabase configuration is valid")})():console.warn("âš ï¸ Supabase is not configured. Please set REACT_APP_USE_SUPABASE_AUTH=true and add your Supabase credentials."),a.createRoot(document.getElementById("root")).render((0,r.jsx)(n.StrictMode,{children:(0,r.jsx)(i.Kd,{children:(0,r.jsxs)(l.A,{theme:f,children:[(0,r.jsx)(o.Ay,{}),(0,r.jsx)(()=>(0,r.jsx)(R,{children:(0,r.jsx)(Us,{})}),{})]})})}))}},e=>{e.O(0,[808,253,506,111,277,363,604,508,207,924,70,753,582,692,179,172,270,22,453,881,465,412,43,255,560],()=>e(e.s=6659)),e.O()}]);